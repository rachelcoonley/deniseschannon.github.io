<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kubernetes Ingress Support in Rancher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for Rancher">
    <link href="/docs/favicon.png" rel="shortcut icon" type="image/png" sizes="16x16">
    <link href="/docs/css/syntax.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/font-awesome/css/font-awesome.min.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/lato/lato.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/lacsso.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/slicknav.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/rancher-docs.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
</head>

<body class="bg-default">
    <div class="row body">
    <header class="page-header">
      <div class="wrap clearfix">
        <nav role="navigation" id="js-responsive-nav" class="clearfix responsive-nav"><a class="nav-toggle"></a>
          <a class="nav-logo logo-caas btn bg-transparent"><img src="/docs/img/rancher-logo-nopadding.svg" class="img-responsive" alt="Rancher" data-pin-nopin="true"></a>
          <ul class="nav-main nav-list">
            <li><a href="http://rancher.com/">Back to Rancher.com</a></li>

            <ul class="nav navbar-nav pull-right">
              <li><a href="https://github.com/rancher/rancher#installation" id="rnchrdm-nav-download" title="Download Rancher" target="_blank"><img src="/docs/img/header-download.svg" alt="Download Rancher" height="12" width="14"> Download Rancher</a></li>
              <li><a href="http://rancher.com/support" id="rnchrdm-nav-reqsupport" title="Request Support"><i class="fa fa-question-circle" aria-hidden="true"></i>
 Request Support</a></li>
            </ul>
          </ul>
      </nav>
    </div>
    <h1>Rancher Docs</h1>
  </header>
  <div class="clearfix"></div>
  <div class="wrap clearfix">
        <div class="col span-3 mt-0 mr-0 sidebar">
        <!--Start Google Search-->
              <div class="gcse-search" id="google-search"></div>
              <script>
              var match = window.location.pathname.match(/\/rancher\/([^\/]+)/);
              if (match) {
                  document.getElementById('google-search').setAttribute('data-defaultToRefinement', match[1]);
              }

              (function() {
                  var cx = '007896692384436596364:60akf3bfmxm';
                  var gcse = document.createElement('script');
                  gcse.type = 'text/javascript';
                  gcse.async = true;
                  gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                  var s = document.getElementsByTagName('script')[0];
                  s.parentNode.insertBefore(gcse, s);
              })();
              </script>
              <!--End Google Search-->

<ul id="menu">
    <li><a href="/docs/rancher/v1.6/zh/">简介</a></li>
    <li><a href="/docs/rancher/v1.6/zh/quick-start-guide/">快速开始</a></li>
    <li>
        <a href="#">安装Rancher<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/">安装 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#安装需求">安装需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#rancher-server-标签">Rancher Server标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署-non-ha">启动 Rancher Server - 单容器部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---多节点的ha部署">启动 Rancher Server - 多节点的HA部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#ha部署需求">HA部署需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---使用外部数据库">启动 Rancher Server - 单容器部署 - 使用外部数据库</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---挂载mysql数据库的数据目录">启动 Rancher Server - 单容器部署 - 挂载MYSQL数据库的数据目录</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#使用aws的elasticclassic-load-balancer作为rancher-server-ha的负载均衡器">使用AWS的ELB作为HA的负载均衡器</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#tls认证使用adopenldap">使用TLS认证的AD/OPENLDAP</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#在http代理后方启动-rancher-server">在HTTP代理后启动 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/selinux/">在SELinux模式下使用Rancher</a></li>
          <li>
               <a href="#">安装Rancher并使用SSL<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#需求">需求</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#nginx-配置模版">NGINX配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#apache-配置例子">Apache配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#haproxy-配置例子">HAProxy配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用aws的elastic-load-balancer作为rancher-server-ha的负载均衡器并使用ssl">使用AWS的ELB作为HA的负载均衡器并使用SSL</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#f5-big-ip配置示例">F5 BIG-IP配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用自签名证书-beta">使用自签名证书</a></li>
               </ul>
          </li>
          <li>
               <a href="#">内网启动Rancher<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用私有镜像仓库">使用私有镜像仓库</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用http代理">使用HTTP代理</a></li>
               </ul>
          </li>
        </ul>
    </li>
    <li>
         <a href="#">升级Rancher Server<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/">升级Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#rancher-server-tags">Rancher Server标签</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#基础设施服务]">升级基础设施服务</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#升级ha架构">升级HA架构的Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---外部数据库">升级非HA模式的Rancher Server - 外部数据库</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---绑定挂载的mysql卷">升级非HA模式的Rancher Server - 绑定挂载的MYSQL卷</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#没有互联网访问的rancher服务器">升级内网中的Rancher Server</a></li>
        </ul>
     </li>
    <li>
         <a href="#">系统设置<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li>
                <a href="#">访问控制方式<i class="pull-right fa fa-angle-down"></i></a>
                <ul>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#活动目录">Active Directory</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#azure-ad">Azure AD</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#github">Github</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#本地身份认证">本地身份认证</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#openldap">OpenLDAP</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#shibboleth">Shibboleth</a></li>
                </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#访问控制">访问控制</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#限制并发登陆">限制并发登陆</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/accounts/">账户</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#主机注册">注册主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#应用商店">应用商店</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/machine-drivers/">主机驱动</a></li>
        </ul>
    </li>
    <li>
          <a href="#">环境<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
            <li><a href="/docs/rancher/v1.6/zh/environments/">环境管理</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#什么是环境模版">环境模版</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#成员角色">环境中的角色</a></li>
          </ul>
    </li>
    <li>
        <a href="#">主机<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/hosts/">主机简介</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#docker版本适用对比">支持的Docker版本</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机标签">主机标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机调度地址">主机调度地址</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在代理后的主机">在代理后的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/custom/">添加自定义主机</a></li>
          <li>
              <a href="#">添加云主机<i class="pull-right fa fa-angle-down"></i></a>
              <ul>
                <li><a href="/docs/rancher/v1.6/zh/hosts/amazon/">添加Amazon EC2主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/azure/">添加Azure主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/digitalocean/">添加DigitalOcean主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/exoscale/">添加Exoscale主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/packet/">添加Packet主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/rackspace/">添加Rackspace主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/other/">添加其他云服务商的主机</a></li>
              </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#访问云提供商的主机">访问云提供商的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在rancher内删除主机">删除主机</a></li>
        </ul>
    </li>
    <li>
      <a href="#">镜像仓库<i class="pull-right fa fa-angle-down"></i></a>
      <ul>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/">镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#不安全的镜像库">不安全的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#自签名证书">自签名证书</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用亚马逊的ecr镜像库">使用亚马逊的ECR镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用google容器镜像仓库">使用Google容器镜像仓库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#更改默认的镜像库">更改默认的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#限制镜像库的使用">限制镜像库的使用</a></li>
      </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/environments/certificates/">证书</a></li>
    <li>
      <a href="#">系统服务<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/">基础设施服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/networking/">网络</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/network-policy/">网络策略</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/load-balancer">负载均衡器</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/dns-service/">DNS服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/metadata-service/">Metadata服务</a></li>
              <li>
                  <a href="#">存储服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/">存储服务</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-nfs/">Rancher NFS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-ebs/">Rancher EBS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/">调度器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#多ip主机调度">多IP主机调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#基于资源约束的调度">基于资源约束的调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#在主机上调度指定服务">在主机上调度指定服务</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/audit-log/">审计日志</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/service-accounts/">服务账号</a></li>
           </ul>
    </li>
    <li>
          <a href="#">Cattle<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
                <li><a href="/docs/rancher/v1.6/zh/cattle/stacks/">应用</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/volumes/">卷</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a></li>
                <li>
                    <a href="#">在UI中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#如何在ui上新增一个负载均衡">添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#服务规则">服务规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#选择器规则">选择器规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止">SSL会话终止</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#负载均衡的会话粘性">负载均衡的会话粘性</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义haproxycfg">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#标签调度负载均衡">标签调度负载均衡</a></li>
                      </ul>
                </li>
                <li>
                    <a href="#">在CLI和Compose中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#用rancher-compose-添加负载均衡">用Rancher Compose 添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#源端口">源端口</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#端口规则">端口规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#证书">证书</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义配置">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#会话粘性策略">会话粘性策略</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#load-balancer-example-l7">七层负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#内部负载均衡例子">内部负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止-example">SSL会话终止示例</a></li>
                      </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-external-services/">外部服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-service-alias/">服务别名</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/health-checks/">健康检查</a></li>
                <li>
                    <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/">调度</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在ui中添加标签">在UI中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在rancher-compose中添加标签">在Rancher Compose中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#调度标签表">调度标签表</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/upgrading/">升级服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/internal-dns-service/">Cattle环境中的内部DNS服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/external-dns-service/">外部DNS服务</a></li>
                <li>
                    <a href="#">Rancher-Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/">Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/commands/">指令与参数</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/environment-interpolation/">环境插值</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/build/">使用AWS S3构建镜像</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/secrets/">密文 - 实验性的</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/webhook-service/">Webhooks</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/labels/">标签</a></li>
          </ul>
    </li>
    <li>
          <a href="#">Kubernetes<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/">启动Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/resiliency-planes/">弹性平面</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/providers/">Cloud Providers</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/private-registry/">私有镜像仓库</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/rbac/">RBAC</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/disaster-recovery/">灾难恢复</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/backups/">备份</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/storage/">持久化存储</a></li>
              <li>
                  <a href="#">插件支持<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/">插件支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#helm">Helm</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#skydns">SkyDNS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">Ingress支持与配置<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/">Ingress支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#基于主机路由配置-ingress-资源">基于主机路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#使用基于路径的路由配置ingress资源">使用基于路径的路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例两个负载均衡器使用交替的端口">多个负载均衡器使用不同的端口</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例使用tls">使用 TLS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#禁用http">禁用HTTP</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例用户定制">示例用户定制</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在所有主机上运行负载均衡器">所有主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在特定主机上运行负载均衡器">特定主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#例将流量导向同一主机上的不同容器">将流量导向同一主机上的不同容器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在同一主机上对容器的流量进行优先级排序">在同一主机上对容器的流量进行优先级排序</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/upgrading/">升级Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/deleting/">删除Kubernetes</a></li>

          </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/mesos/">Mesos</a></li>
    <li><a href="/docs/rancher/v1.6/zh/swarm/">Swarm - 实验性的 </a></li>
    <li><a href="/docs/rancher/v1.6/zh/windows/">Windows - 实验性的</a></li>
    <li><a href="/docs/rancher/v1.6/zh/native-docker/">以原生Docker命令行的形式使用Rancher</a></li>
    <li>
            <a href="#">应用商店<i class="pull-right fa fa-angle-down"></i></a>
            <ul>
                <li><a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a></li>
                <li><a href="/docs/rancher/v1.6/zh/catalog/private-catalog/">创建私有应用商店</a></li>
            </ul>
        </li>
    <li><a href="#">Rancher命令行<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/cli/">Rancher命令行</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/commands/">命令和选项</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/variable-interpolation/">变量替换</a></li>
        </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/api/v2-beta/">API文档</a></li>
    <li><a href="/docs/rancher/v1.6/zh/contributing/">Rancher社区贡献</a></li>
    <li>
        <a href="#">常见问题<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/faqs/server/">Rancher Server的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/agents/">Rancher Agent的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/troubleshooting/">常见的故障排查与修复方法</a></li>
        </ul>
    </li>
    <li>
        <a href="#" class="btn-docs">历史文档<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.5/zh/">Rancher v1.5</a></li>
            <li><a href="/docs/rancher/v1.4/zh/">Rancher v1.4</a></li>
            <li><a href="/docs/rancher/v1.3/zh/">Rancher v1.3</a></li>
            <li><a href="/docs/rancher/v1.2/zh/">Rancher v1.2</a></li>
            <li><a href="/docs/rancher/v1.1/zh/">Rancher v1.1</a></li>
            <li><a href="/docs/rancher/v1.0/en/">Rancher v1.0</a></li>
        </ul>
    </li>
</ul>

</div>
<div class="col span-9">
    <div class="content-container">
        <h2 id="ingress-support">Ingress Support</h2>
<hr />

<p>在开始使用 <a href="http://kubernetes.io/docs/user-guide/ingress/">Kubernetes Ingress</a>资源之前，你需要准备一个Kubernetes<a href="/docs/rancher/v1.6/zh/environments/">环境</a> 。并且建议在本地电脑上<a href="/docs/rancher/v1.6/zh/kubernetes/#kubectl">设置kubectl</a> ，以便更容易地将Kubernetes的资源发布到Rancher中。或者，你可以使用Rancher UI提供的shell来启动资源。</p>

<p>Kubernetes Ingress资源可以支持你选择的任何负载均衡器类型，因此，为了利用Rancher的负载均衡功能，我们引入了Rancher Ingress控制器的概念。ingress控制器是ingress-controller服务的一部分，它做为Kubernetes系统栈的组件被部署。</p>

<p>ingress控制器管理着Rancher负载均衡器的创建/迁移/更新。每个负载均衡器的创建/删除/更新都是基于 Kubernetes ingress 资源。</p>

<p>如果一个ingress被更新或服务端点（Service endpoint）被更改，ingress控制器将更新相应的Rancher负载均衡器，使其与ingress的变化相对应。</p>

<p>同理，如果ingress被移除，Rancher负载均衡器也会被移除。如果一个ingress的后端服务发生了变化(例如，当复制控制器被放大或缩小或重新创建一个pod时)，Rancher负载均衡器也将相应地更新。ingress控制器确保了Rancher负载均衡器与Kubernetes的ingress和后端服务相匹配。</p>

<h3 id="section">目前的局限性</h3>

<ul>
  <li>Ingress资源只能通过kubectl工具添加</li>
</ul>

<h3 id="rancher-ingress-">Rancher Ingress 控制器</h3>

<p>Rancher ingress控制器利用Rancher中现有的负载均衡功能，将Kubernetes ingress的内容转换到Rancher的负载均衡器。</p>

<p>ingress controller 功能:</p>

<ul>
  <li>监听Kubernetes服务器事件;</li>
  <li>部署负载平衡器，并将其与Ingress中定义的路由规则进行适配;</li>
  <li>通过配置Ingress <code class="highlighter-rouge">Address</code> 字段来做为负载均衡器的公共接入地址。</li>
</ul>

<h3 id="rancheringress">在Rancher中创建Ingress资源</h3>

<h4 id="nginx">设置一个Nginx服务示例</h4>

<p>在配置任何ingress之前, 需要在Kubernetes中创建服务. 首先在Kubernetes环境中添加一个服务和复制控制器（Replication Controller）。</p>

<p>这里添加单个的nginx服务到Kubernetes中。</p>

<p>示例：<code class="highlighter-rouge">nginx-service.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>让我们使用kubectl将nginx服务发布到Kubernetes。请记住,  你也可以为本地机器配置kubectl ，或者在Kubernetes/kubectl的UI中使用shell。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f nginx-service.yml
service <span class="s2">"nginx-service"</span> created
replicationcontroller <span class="s2">"nginx-service"</span> created
</code></pre>
</div>

<h4 id="ingress">配置单个ingress资源</h4>

<p>你可以为单个服务设置单一的ingress资源。</p>

<p>示例：<code class="highlighter-rouge">simple-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">simplelb</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>让我们使用kubectl创建ingress。在创建ingress后, ingress 控制器将触发创建一个负载均衡器并且可以在<strong>Kubernetes</strong> -&gt; <strong>System</strong>  标签栏中看到创建的 <strong>kubernetes-ingress-lbs</strong> 应用栈 .</p>

<p>默认情况下，负载均衡器服务只有一个实例被部署。 通过<code class="highlighter-rouge">kubectl</code>, 可以看到 ingress被创建, 但通过UI只能看到负载均衡器应用.  ingress控制器已经完成了所有ingress转换到Rancher负载均衡器的请求。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f simple-ingress.yml
ingress <span class="s2">"simplelb"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME          RULE      BACKEND            ADDRESS          AGE
simplelb      -         nginx-service:80   1.2.3.4          5m
</code></pre>
</div>

<p>ingress中的address将是负载均衡器服务启动的公共接入地址。如果负载均衡器被移动到不同的主机并得到不同的公共端点（public endpoint），则ingress地址将被更新。</p>

<p>你可以在缺省端口80(例如：http://1.2.3.4:80)或直接访问地址(例如：http://1.2.3.4)来访问你的应用。</p>

<h4 id="section-1">配置多个服务</h4>

<p>如果你希望ingress做为多个服务的入口点，那么需要使用主机名路由规则来配置它，它允许将host/path 的路由添加到服务。</p>

<p>让我们添加多个服务到 Kubernetes中.</p>

<p>示例：<code class="highlighter-rouge">multiple-nginx-services.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>让我们用kubectl将我们的服务和复制控制器发布到Kubernetes中，请记住，你可以为本地机器配置kubectl，也可以在Kubernetes-kubectl的UI中使用shell。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f multiple-nginx-services.yml
service <span class="s2">"nginx-service-1"</span> created
replicationcontroller <span class="s2">"nginx-service-1"</span> created
service <span class="s2">"nginx-service-2"</span> created
replicationcontroller <span class="s2">"nginx-service-2"</span> created
</code></pre>
</div>

<h4 id="ingress-">基于主机路由配置 Ingress 资源</h4>

<p>示例：<code class="highlighter-rouge">host-based-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">host-based-ingress</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">foo.bar.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">bar.foo.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>让我们使用kubectl创建ingress。在创建ingress后, ingress 控制器 将触发创建一个负载均衡器并且可以在<strong>Kubernetes</strong> -&gt; <strong>System</strong>  标签栏中看到创建的 <strong>kubernetes-ingress-lbs</strong> 应用栈 .</p>

<p>默认情况下，负载均衡器服务只有一个实例被部署。 通过ingress，负载均衡器将有一个以主机名命名的路由规则被创建。</p>

<p>通过<code class="highlighter-rouge">kubectl</code>, 可以看到 ingress 被创建, 但通过UI只能看到负载均衡器应用.  ingress控制器已经完成了所有ingress转换到Rancher负载均衡器的请求。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f host-based-ingress.yml
ingress <span class="s2">"host-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME                    RULE            BACKEND             ADDRESS     AGE
host-based-ingress      -                                   1.2.3.4     20m
                        foo.bar.com
                                        nginx-service-1:80
                        foo1.bar.com
                                        nginx-service-2:80
</code></pre>
</div>

<p>与单个ingress负载均衡器类似，这个负载均衡器将在Kubernetes/System选项卡中位于Kubernetes-lbs的应用栈中。</p>

<p>ingress中的地址将是负载均衡器服务启动的公共接入地址。.如果负载均衡器被移动到不同的主机并得到不同的公共端点，则ingress地址将被更新</p>

<p>你可以在缺省端口80(例如：http://1.2.3.4:80)或直接访问地址(例如：http://1.2.3.4)。来访问你的应用。</p>

<h4 id="ingress-1">使用基于路径的路由配置Ingress资源</h4>

<p>如果有多个想要做负载均衡的服务，那么可以向ingress添加基于路径的路由。</p>

<p>示例：<code class="highlighter-rouge">path-based-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">path-based-ingress</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">foo.bar.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">path</span><span class="pi">:</span> <span class="s">/foo</span>
        <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
      <span class="pi">-</span> <span class="s">path</span><span class="pi">:</span> <span class="s">/bar</span>
        <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>让我们使用kubectl创建ingress。在创建ingress后, ingress 控制器 将触发创建一个负载均衡器并且可以在<strong>Kubernetes</strong> -&gt; <strong>System</strong>  标签栏中看到创建的 <strong>kubernetes-ingress-lbs</strong> 应用栈。默认情况下，负载均衡器服务只有一个实例被部署。负载均衡器将拥有从ingress创建的主机名路由规则。</p>

<p>通过<code class="highlighter-rouge">kubectl</code>, 可以看到 ingress 被创建, 但是UI中只能看到负载均衡器应用.  ingress控制器已经完成了所有在ingress中的转换到Rancher负载均衡器的请求。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f path-based-ingress.yml
ingress <span class="s2">"path-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME                    RULE            BACKEND             ADDRESS            AGE
path-based-ingress      -                                   1.2.3.4             15s
                        foo.bar.com
                        /foo            nginx-service1:80
                        /bar            nginx-service2:80
</code></pre>
</div>

<p>与单个的ingress负载均衡器类似，这个负载均衡器将在Kubernetes-System选项卡中位于Kubernetes-lbs的堆栈中。</p>

<p>ingress中的address将是负载均衡器服务启动的公共接入地址。如果负载均衡器被移动到不同的主机并得到不同的公共端点，则ingress地址将被更新。</p>

<p>要访问你的应用程序，可以在缺省端口80(例如：http://1.2.3.4:80)或地址直接访问地址(例如：http://1.2.3.4)。</p>

<h3 id="kubernetes-ingress">Kubernetes Ingress的负载均衡器选项</h3>

<p>默认情况下，Kubernetes ingress将在默认80/443端口上使用http/https部署1个负载均衡器实例。Rancher可支持多组负载均衡，用户可以根据需要自行制定端口。扩展ingress后，Kubernetes 配置的地址将被复制到所有负载均衡器。</p>

<h4 id="section-2">示例:</h4>

<ul>
  <li><a href="#示例两个负载均衡器使用交替的端口">多个负载均衡器使用不同的端口</a></li>
  <li><a href="#示例使用tls">使用 TLS</a></li>
  <li><a href="#禁用http">禁用HTTP</a></li>
  <li><a href="#示例用户定制">自定义HAProxy</a></li>
  <li><a href="#示例在所有主机上运行负载均衡器">所有主机运行负载均衡器</a></li>
  <li><a href="#示例在特定主机上运行负载均衡器">特定主机运行负载均衡器</a></li>
</ul>

<blockquote>
  <p><strong>注意：</strong> 如果增加ingress实例数量，你需要确保在Kubernetes环境中至少有同等数量的主机可用。</p>

</blockquote>

<h4 id="section-3">设置单个服务</h4>

<p>在建立任何一个ingress之前，需要在Kubernetes中创建服务。首先在Kubernetes环境中添加一个服务和复制控制器。</p>

<p>这里向Kubernetes添加一个单个的nginx服务。</p>

<p>示例：<code class="highlighter-rouge">nginx-service.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>使用kubectl，让我们将nginx服务发布到Kubernetes。请记住，你可以为本地机器配置kubectl，也可以在Kubernetes-kubectl的UI中使用shell。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f nginx-service.yml
service <span class="s2">"nginx-service"</span> created
replicationcontroller <span class="s2">"nginx-service"</span> created
</code></pre>
</div>
<p>#### <em>示例：两个负载均衡器使用交替的端口</em></p>

<p>你可以在两个不同的主机上运行2个负载均衡器启动一个ingress，它使用一个99端口代替默认的80端口。为了让这个ingress正常工作，你的kubernetes环境至少需要两台拥有99端口的主机。</p>

<p>示例：<code class="highlighter-rouge">scaled-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">scaledlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Scaling to 2 load balancer instances</span>
    <span class="s">scale</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2"</span>
    <span class="c1"># Using a different port (not 80)</span>
    <span class="s">http.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">99"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>让我们使用kubectl创建ingress。在创建ingress之后，ingress控制器将触发在Kubernetes-System选项卡中创建的负载均衡器服务，并在Kubernetes-ingss-lbs堆栈中可见。由于在ingress中<code class="highlighter-rouge">scale</code> 设置为2，所以在负载均衡器服务中会有两个负载均衡器实例被部署。。</p>

<p>在kubectl中，你可以看到ingress创建，但是UI只显示负载均衡器。ingress控制器已经完成了在ingress转化到Rancher负载均衡器的所有请求。因为有两个负载均衡器，需要在ingress中设置两个地址。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f scaled-ingress.yml
ingress <span class="s2">"host-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME       RULE      BACKEND            ADDRESS             AGE
simplelb   -         nginx-service:90   1.2.3.4,5.6.7.8     41s
</code></pre>
</div>

<h4 id="tls">示例：使用TLS</h4>

<p><strong><em>如果你想要在Kubernetes中使用TLS，那么你需要将证书添加到Rancher中。在Rancher中添加的证书可以用于为TLS终端提供一个安全的ingress。</em></strong></p>

<p><em>假设我们添加了一个名为foo的证书</em></p>

<p>示例：<code class="highlighter-rouge">tls-ingress.yml</code> 使用这个 <code class="highlighter-rouge">foo</code> 证书。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">tlslb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="s">https.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">444"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">tls</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">secretName</span><span class="pi">:</span> <span class="s">foo</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>让我们使用kubectl创建ingress。在创建ingress之后，ingress控制器将触发在Kubernetes-System选项卡中创建的负载均衡器服务，并在Kubernetes-ingss-lbs堆栈中可见。默认情况下，负载均衡器服务只有一个负载均衡器的实例被部署。</p>

<p>在kubectl中，你可以看到ingress被创建，但是UI只显示负载均衡器应用。ingress控制器已经完成了在ingress中转换到Rancher负载均衡器所有请求的。</p>

<h4 id="http"><strong>禁用HTTP</strong></h4>

<p><strong><em>默认情况下，即使使用了TLS，端口80也是可以访问的。为了阻止80端口，你可以添加额外的参数（annotation） (allow.http: “false”)做为ingress模板的一部分。</em></strong></p>

<p>示例：<code class="highlighter-rouge">tls-ingress.yml</code> and 禁用80 端口</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">tlslb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="s">https.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">444"</span>
    <span class="c1"># Added to block HTTP</span>
    <span class="s">allow.http</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">tls</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">secretName</span><span class="pi">:</span> <span class="s">foo</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>
<p>#### 示例：用户定制</p>

<p>在Rancher中，我们的负载均衡器运行的是HAProxy软件。如果你想要定制负载均衡器配置文件的<code class="highlighter-rouge">global</code> 和<code class="highlighter-rouge">defaults</code> 部分，可以通过ingress注释(annotations)来配置它们。</p>

<p>示例：<code class="highlighter-rouge">custom-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">customlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Customizing HAProxy in the load balancer</span>
    <span class="s">config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">defaults</span><span class="se">\n</span><span class="s">balance</span><span class="nv"> </span><span class="s">source</span><span class="se">\n</span><span class="s">timeout</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">70000</span><span class="se">\n</span><span class="s">global</span><span class="se">\n</span><span class="s">maxconnrate</span><span class="nv"> </span><span class="s">60"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p><strong><em>在配置中，默认和全局关键字标识可自定义的部分，后面应该紧跟着有新的换行。 这些部分中的每个参数都应该跟着一条新的换行。</em></strong></p>

<h4 id="section-4">示例:在所有主机上运行负载均衡器</h4>

<p>在当前环境中，可以让负载均衡器在所有主机上运行。这些全局负载均衡器可以使用注释（annotations）进行调度，i.e. <code class="highlighter-rouge">io.Rancher.scheduler.global: "true"</code>.</p>

<p>示例：<code class="highlighter-rouge">global-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">globallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Create load balancers on every host in the environment</span>
    <span class="s">io.Rancher.scheduler.global</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<h4 id="section-5">示例：在特定主机上运行负载均衡器</h4>

<p>在当前环境中，你可以将负载均衡器安排到某个特定主机上。为了将负载均衡器安排到特定的主机上，你需要向主机添加标签。主机上的标签是一个键值对，比如你可以给主机设置标签为foo=bar。主机添加标签之后，你需要使用参数annotation，（如Rancher.scheduler.affinity.host_label: “foo=bar”`）以使负载均衡器容器安排到标记的主机上。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">scheduledlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Search for a host that has label foo=bar and schedule the load balancer on that host.</span>
    <span class="s">io.Rancher.scheduler.affinity.host_label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">foo=bar"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<h4 id="section-6">例：将流量导向同一主机上的不同容器</h4>

<p><em>你可以配置负载均衡器，将流量路由到与负载均衡器容器同一主机上的服务容器。如果主机上没有目标服务的容器，那么负载均衡器不会将任何流量路由到目标服务的其他容器，就像它们在其他主机上一样。为了配置负载均衡器，你需要使用annotation参数i.e. <code class="highlighter-rouge">io.Rancher.lb_service.target: "only-local"</code>.</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">onlylocallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Direct traffic to only containers that are on the same host as the load balancer container</span>
    <span class="s">io.Rancher.lb_service.target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">only-local"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<h4 id="section-7">示例：在同一主机上对容器的流量进行优先级排序</h4>

<p>对于一个多实例服务，你可以配置负载均衡器，使流量优先分配到与负载均衡器容器相同主机的服务容器中。如果主机上没有目标服务的容器，则负载均衡器将流量引导到目标服务所在的其他主机上。为了配置负载均衡器，你将使用一个annotation， i.e. <code class="highlighter-rouge">io.Rancher.lb_service.target: "prefer-local"</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">preferlocallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Prioritize traffic to containers that are on the same host as the load balancer container</span>
    <span class="s">io.Rancher.lb_service.target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">prefer-local"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<h4 id="section-8">示例：粘滞会话</h4>

<p>可以为Rancher负载均衡器中运行的HAProxy软件的配置粘性策略。</p>

<p><strong>例如，你可以配置负载均衡器使来自相同源的流量路由到相同的容器。</strong></p>

<p>为了配置负载均衡器,你需要使用一条包括粘性政策的annotation参数 (i.e. <code class="highlighter-rouge">io.Rancher.stickiness.policy</code>)。</p>

<p>可以设置一个HAProxy软件能够识别的关键参数 \n做为界限值。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">test</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Configure stickiness policy</span>
    <span class="s">io.Rancher.stickiness.policy</span><span class="pi">:</span> <span class="s2">"</span><span class="s">name:</span><span class="nv"> </span><span class="s">testname</span><span class="se">\n</span><span class="nv"> </span><span class="s">cookie:</span><span class="nv"> </span><span class="s">cookie123</span><span class="se">\n</span><span class="s">domain:</span><span class="nv"> </span><span class="s">test.domain"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

    </div>
</div>
</div>
</div>

<div class="row wrap">
<a class="btn btn-primary pull-right" href="https://github.com/rancher/rancher.github.io/tree/master/rancher/latest/zh/kubernetes/ingress/index.md">Edit this page <i class="fa fa-pencil"></i></a>
</div>

<footer class="clearfix">
  <div class="wrap">
    <div class=""><!--bottom footer-->
      <div class="row">
          <div class="col span-6">
              <ul id="menu-footer" class="list-inline">
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="About Rancher Labs" href="http://rancher.com/about/">About Rancher Labs</a></li>
                  <li id="menu-item-11352" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11352"><a title="Contact" href="http://rancher.com/contact/">Contact</a></li>
                  <li id="menu-item-14152" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14152"><a title="Privacy" href="http://rancher.com/privacy/">Privacy</a></li>
                  <li id="menu-item-15635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-15635"><a title="Careers" href="http://rancher.com/careers/">Careers</a></li>
                  
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="English Docs" href="https://rancher.com/docs/rancher/latest/en/">English Docs</a></li>
                  
              </ul>
              <p>Copyright &copy; 2014-2017 <a href="http://rancher.com">Rancher Labs</a>. All Rights Reserved.</p>
          </div>
          <div class="col span-6 text-right">
              <ul class="list-inline">
                  <li><a href="https://github.com/rancher/rancher" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-github.png" alt="Rancher Labs GitHub"></a></li>
                  <li><a href="https://twitter.com/Rancher_Labs" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-twitter.png" alt="Rancher Labs Twitter"></a></li>
                  <li><a href="https://slack.rancher.io/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-slack.png" alt="Rancher Labs Slack"></a></li>
                  <li><a href="https://www.linkedin.com/groups/6977008/profile" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-linkedin.png" alt="Rancher Labs LinkedIn"></a></li>
                  <li><a href="https://www.facebook.com/rancherlabs/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-fb.png" alt="Rancher Labs Facebook"></a></li>
              </ul>
          </div>
      </div>
    </div><!--bottom footer-->
    </div>
</footer>
<script src="/docs/vendor/jquery.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/jquery.slicknav.min.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/rancher-docs.js?t=2017-12-04 13:23:19 -0800"></script>
<!-- Start of Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-56382716-3', 'auto');
ga('send', 'pageview');
</script>
<!-- End of Google Analytics -->
<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d, s, i, r) {
    if (d.getElementById(i)) { return; }
    var n = d.createElement(s),
        e = d.getElementsByTagName(s)[0];
    n.id = i;
    n.src = '//js.hs-analytics.net/analytics/' + (Math.ceil(new Date() / r) * r) + '/468859.js';
    e.parentNode.insertBefore(n, e);
})(document, "script", "hs-analytics", 300000);
</script>
<!-- End of Async HubSpot Analytics Code -->
</body>

</html>

