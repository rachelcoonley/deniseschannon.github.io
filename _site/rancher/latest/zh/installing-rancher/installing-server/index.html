<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Installing Rancher Server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for Rancher">
    <link href="/docs/favicon.png" rel="shortcut icon" type="image/png" sizes="16x16">
    <link href="/docs/css/syntax.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/font-awesome/css/font-awesome.min.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/lato/lato.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/lacsso.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/slicknav.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/rancher-docs.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
</head>

<body class="bg-default">
    <div class="row body">
    <header class="page-header">
      <div class="wrap clearfix">
        <nav role="navigation" id="js-responsive-nav" class="clearfix responsive-nav"><a class="nav-toggle"></a>
          <a class="nav-logo logo-caas btn bg-transparent"><img src="/docs/img/rancher-logo-nopadding.svg" class="img-responsive" alt="Rancher" data-pin-nopin="true"></a>
          <ul class="nav-main nav-list">
            <li><a href="http://rancher.com/">Back to Rancher.com</a></li>

            <ul class="nav navbar-nav pull-right">
              <li><a href="https://github.com/rancher/rancher#installation" id="rnchrdm-nav-download" title="Download Rancher" target="_blank"><img src="/docs/img/header-download.svg" alt="Download Rancher" height="12" width="14"> Download Rancher</a></li>
              <li><a href="http://rancher.com/support" id="rnchrdm-nav-reqsupport" title="Request Support"><i class="fa fa-question-circle" aria-hidden="true"></i>
 Request Support</a></li>
            </ul>
          </ul>
      </nav>
    </div>
    <h1>Rancher Docs</h1>
  </header>
  <div class="clearfix"></div>
  <div class="wrap clearfix">
        <div class="col span-3 mt-0 mr-0 sidebar">
        <!--Start Google Search-->
              <div class="gcse-search" id="google-search"></div>
              <script>
              var match = window.location.pathname.match(/\/rancher\/([^\/]+)/);
              if (match) {
                  document.getElementById('google-search').setAttribute('data-defaultToRefinement', match[1]);
              }

              (function() {
                  var cx = '007896692384436596364:60akf3bfmxm';
                  var gcse = document.createElement('script');
                  gcse.type = 'text/javascript';
                  gcse.async = true;
                  gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                  var s = document.getElementsByTagName('script')[0];
                  s.parentNode.insertBefore(gcse, s);
              })();
              </script>
              <!--End Google Search-->

<ul id="menu">
    <li><a href="/docs/rancher/v1.6/zh/">简介</a></li>
    <li><a href="/docs/rancher/v1.6/zh/quick-start-guide/">快速开始</a></li>
    <li>
        <a href="#">安装Rancher<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/">安装 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#安装需求">安装需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#rancher-server-标签">Rancher Server标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署-non-ha">启动 Rancher Server - 单容器部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---多节点的ha部署">启动 Rancher Server - 多节点的HA部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#ha部署需求">HA部署需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---使用外部数据库">启动 Rancher Server - 单容器部署 - 使用外部数据库</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---挂载mysql数据库的数据目录">启动 Rancher Server - 单容器部署 - 挂载MYSQL数据库的数据目录</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#使用aws的elasticclassic-load-balancer作为rancher-server-ha的负载均衡器">使用AWS的ELB作为HA的负载均衡器</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#tls认证使用adopenldap">使用TLS认证的AD/OPENLDAP</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#在http代理后方启动-rancher-server">在HTTP代理后启动 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/selinux/">在SELinux模式下使用Rancher</a></li>
          <li>
               <a href="#">安装Rancher并使用SSL<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#需求">需求</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#nginx-配置模版">NGINX配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#apache-配置例子">Apache配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#haproxy-配置例子">HAProxy配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用aws的elastic-load-balancer作为rancher-server-ha的负载均衡器并使用ssl">使用AWS的ELB作为HA的负载均衡器并使用SSL</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#f5-big-ip配置示例">F5 BIG-IP配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用自签名证书-beta">使用自签名证书</a></li>
               </ul>
          </li>
          <li>
               <a href="#">内网启动Rancher<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用私有镜像仓库">使用私有镜像仓库</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用http代理">使用HTTP代理</a></li>
               </ul>
          </li>
        </ul>
    </li>
    <li>
         <a href="#">升级Rancher Server<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/">升级Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#rancher-server-tags">Rancher Server标签</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#基础设施服务]">升级基础设施服务</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#升级ha架构">升级HA架构的Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---外部数据库">升级非HA模式的Rancher Server - 外部数据库</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---绑定挂载的mysql卷">升级非HA模式的Rancher Server - 绑定挂载的MYSQL卷</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#没有互联网访问的rancher服务器">升级内网中的Rancher Server</a></li>
        </ul>
     </li>
    <li>
         <a href="#">系统设置<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li>
                <a href="#">访问控制方式<i class="pull-right fa fa-angle-down"></i></a>
                <ul>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#活动目录">Active Directory</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#azure-ad">Azure AD</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#github">Github</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#本地身份认证">本地身份认证</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#openldap">OpenLDAP</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#shibboleth">Shibboleth</a></li>
                </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#访问控制">访问控制</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#限制并发登陆">限制并发登陆</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/accounts/">账户</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#主机注册">注册主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#应用商店">应用商店</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/machine-drivers/">主机驱动</a></li>
        </ul>
    </li>
    <li>
          <a href="#">环境<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
            <li><a href="/docs/rancher/v1.6/zh/environments/">环境管理</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#什么是环境模版">环境模版</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#成员角色">环境中的角色</a></li>
          </ul>
    </li>
    <li>
        <a href="#">主机<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/hosts/">主机简介</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#docker版本适用对比">支持的Docker版本</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机标签">主机标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机调度地址">主机调度地址</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在代理后的主机">在代理后的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/custom/">添加自定义主机</a></li>
          <li>
              <a href="#">添加云主机<i class="pull-right fa fa-angle-down"></i></a>
              <ul>
                <li><a href="/docs/rancher/v1.6/zh/hosts/amazon/">添加Amazon EC2主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/azure/">添加Azure主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/digitalocean/">添加DigitalOcean主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/exoscale/">添加Exoscale主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/packet/">添加Packet主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/rackspace/">添加Rackspace主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/other/">添加其他云服务商的主机</a></li>
              </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#访问云提供商的主机">访问云提供商的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在rancher内删除主机">删除主机</a></li>
        </ul>
    </li>
    <li>
      <a href="#">镜像仓库<i class="pull-right fa fa-angle-down"></i></a>
      <ul>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/">镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#不安全的镜像库">不安全的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#自签名证书">自签名证书</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用亚马逊的ecr镜像库">使用亚马逊的ECR镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用google容器镜像仓库">使用Google容器镜像仓库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#更改默认的镜像库">更改默认的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#限制镜像库的使用">限制镜像库的使用</a></li>
      </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/environments/certificates/">证书</a></li>
    <li>
      <a href="#">系统服务<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/">基础设施服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/networking/">网络</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/network-policy/">网络策略</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/load-balancer">负载均衡器</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/dns-service/">DNS服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/metadata-service/">Metadata服务</a></li>
              <li>
                  <a href="#">存储服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/">存储服务</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-nfs/">Rancher NFS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-ebs/">Rancher EBS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/">调度器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#多ip主机调度">多IP主机调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#基于资源约束的调度">基于资源约束的调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#在主机上调度指定服务">在主机上调度指定服务</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/audit-log/">审计日志</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/service-accounts/">服务账号</a></li>
           </ul>
    </li>
    <li>
          <a href="#">Cattle<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
                <li><a href="/docs/rancher/v1.6/zh/cattle/stacks/">应用</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/volumes/">卷</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a></li>
                <li>
                    <a href="#">在UI中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#如何在ui上新增一个负载均衡">添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#服务规则">服务规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#选择器规则">选择器规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止">SSL会话终止</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#负载均衡的会话粘性">负载均衡的会话粘性</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义haproxycfg">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#标签调度负载均衡">标签调度负载均衡</a></li>
                      </ul>
                </li>
                <li>
                    <a href="#">在CLI和Compose中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#用rancher-compose-添加负载均衡">用Rancher Compose 添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#源端口">源端口</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#端口规则">端口规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#证书">证书</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义配置">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#会话粘性策略">会话粘性策略</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#load-balancer-example-l7">七层负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#内部负载均衡例子">内部负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止-example">SSL会话终止示例</a></li>
                      </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-external-services/">外部服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-service-alias/">服务别名</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/health-checks/">健康检查</a></li>
                <li>
                    <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/">调度</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在ui中添加标签">在UI中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在rancher-compose中添加标签">在Rancher Compose中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#调度标签表">调度标签表</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/upgrading/">升级服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/internal-dns-service/">Cattle环境中的内部DNS服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/external-dns-service/">外部DNS服务</a></li>
                <li>
                    <a href="#">Rancher-Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/">Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/commands/">指令与参数</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/environment-interpolation/">环境插值</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/build/">使用AWS S3构建镜像</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/secrets/">密文 - 实验性的</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/webhook-service/">Webhooks</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/labels/">标签</a></li>
          </ul>
    </li>
    <li>
          <a href="#">Kubernetes<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/">启动Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/resiliency-planes/">弹性平面</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/providers/">Cloud Providers</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/private-registry/">私有镜像仓库</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/rbac/">RBAC</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/disaster-recovery/">灾难恢复</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/backups/">备份</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/storage/">持久化存储</a></li>
              <li>
                  <a href="#">插件支持<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/">插件支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#helm">Helm</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#skydns">SkyDNS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">Ingress支持与配置<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/">Ingress支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#基于主机路由配置-ingress-资源">基于主机路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#使用基于路径的路由配置ingress资源">使用基于路径的路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例两个负载均衡器使用交替的端口">多个负载均衡器使用不同的端口</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例使用tls">使用 TLS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#禁用http">禁用HTTP</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例用户定制">示例用户定制</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在所有主机上运行负载均衡器">所有主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在特定主机上运行负载均衡器">特定主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#例将流量导向同一主机上的不同容器">将流量导向同一主机上的不同容器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在同一主机上对容器的流量进行优先级排序">在同一主机上对容器的流量进行优先级排序</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/upgrading/">升级Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/deleting/">删除Kubernetes</a></li>

          </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/mesos/">Mesos</a></li>
    <li><a href="/docs/rancher/v1.6/zh/swarm/">Swarm - 实验性的 </a></li>
    <li><a href="/docs/rancher/v1.6/zh/windows/">Windows - 实验性的</a></li>
    <li><a href="/docs/rancher/v1.6/zh/native-docker/">以原生Docker命令行的形式使用Rancher</a></li>
    <li>
            <a href="#">应用商店<i class="pull-right fa fa-angle-down"></i></a>
            <ul>
                <li><a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a></li>
                <li><a href="/docs/rancher/v1.6/zh/catalog/private-catalog/">创建私有应用商店</a></li>
            </ul>
        </li>
    <li><a href="#">Rancher命令行<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/cli/">Rancher命令行</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/commands/">命令和选项</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/variable-interpolation/">变量替换</a></li>
        </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/api/v2-beta/">API文档</a></li>
    <li><a href="/docs/rancher/v1.6/zh/contributing/">Rancher社区贡献</a></li>
    <li>
        <a href="#">常见问题<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/faqs/server/">Rancher Server的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/agents/">Rancher Agent的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/troubleshooting/">常见的故障排查与修复方法</a></li>
        </ul>
    </li>
    <li>
        <a href="#" class="btn-docs">历史文档<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.5/zh/">Rancher v1.5</a></li>
            <li><a href="/docs/rancher/v1.4/zh/">Rancher v1.4</a></li>
            <li><a href="/docs/rancher/v1.3/zh/">Rancher v1.3</a></li>
            <li><a href="/docs/rancher/v1.2/zh/">Rancher v1.2</a></li>
            <li><a href="/docs/rancher/v1.1/zh/">Rancher v1.1</a></li>
            <li><a href="/docs/rancher/v1.0/en/">Rancher v1.0</a></li>
        </ul>
    </li>
</ul>

</div>
<div class="col span-9">
    <div class="content-container">
        <h2 id="rancher-server">安装 Rancher Server</h2>
<hr />
<p>Rancher是使用一系列的Docker容器进行部署的。运行Rancher跟启动两个容器一样简单。一个容器作为管理服务器部署，另外一个作为集群节点的Agent部署</p>

<ul>
  <li><a href="#single-container">Rancher Server - 单容器部署 (non-HA)</a></li>
  <li><a href="#single-container-external-database">Rancher Server - 单容器部署 (non-HA) - 使用外置数据库</a></li>
  <li><a href="#single-container-bind-mount">Rancher Server - 单容器部署 (non-HA)- 挂载MySQL数据库的数据目录</a></li>
  <li><a href="#multi-nodes">Rancher Server - 多节点的HA部署</a></li>
  <li><a href="#elb">Rancher Server - 使用AWS的Elastic/Classic Load Balancer作为Rancher Server HA的负载均衡器</a></li>
  <li><a href="#ldap">Rancher Server - 使用TLS认证的AD/OPENLDAP</a></li>
  <li><a href="#http-proxy">Rancher Server - 在HTTP代理后方启动 Rancher Server</a></li>
  <li><a href="#mysql-ssl">Rancher Server - 通过SSL连接MySQL</a></li>
</ul>

<blockquote>
  <p><strong>注意：</strong> 你可以运行Rancher Server的容器的命令 <code class="highlighter-rouge">docker run rancher/server --help</code> 来获得所有选项以及帮助信息。</p>
</blockquote>

<h3 id="section">安装需求</h3>

<ul>
  <li>所有安装有<a href="/docs/rancher/v1.6/zh/hosts/#docker版本适用对比">支持的Docker版本</a>的现代Linux发行版。 <a href="http://docs.rancher.com/os/">RancherOS</a>, Ubuntu, RHEL/CentOS 7 都是经过严格的测试。
    <ul>
      <li>对于 RHEL/CentOS, 默认的 storage driver, 例如 devicemapper using loopback, 并不被<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#/storage-driver-options">Docker</a>推荐。 请参考Docker的文档去修改使用其他的storage driver。</li>
      <li>对于 RHEL/CentOS, 如果你想使用 SELinux, 你需要<a href="/docs/rancher/v1.6/zh/installing-rancher/selinux/">安装额外的 SELinux 组件</a>.</li>
    </ul>
  </li>
  <li>1GB内存</li>
  <li>精确的时钟同步服务 (例如 <code class="highlighter-rouge">ntpd</code>)</li>
  <li>MySQL服务器需要 max_connections 的设置 &gt; 150
    <ul>
      <li>MYSQL配置需求
        <ul>
          <li>选项1: 用默认<code class="highlighter-rouge">COMPACT</code>选项运行Antelope</li>
          <li>选项2: 运行MySQL 5.7，使用Barracuda。默认选项<code class="highlighter-rouge">ROW_FORMAT</code>需设置成<code class="highlighter-rouge">Dynamic</code></li>
        </ul>
      </li>
      <li>推荐设定
        <ul>
          <li>max_packet_size &gt;= 32M</li>
          <li>innodb_log_file_size &gt;= 256M (如果你已有现存数据库，请根据实际情况更改此设定)</li>
          <li>innodb_file_per_table=1</li>
          <li>innodb_buffer_pool_size &gt;= 1GB (对于更高需求的配置，请在专属MySQL服务器机器上使用4-8G的值)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>注意：</strong> 目前Rancher中并不支持Docker for Mac</p>
</blockquote>

<h3 id="rancher-server-">Rancher Server 标签</h3>

<p>Rancher Server当前版本中有2个不同的标签。对于每一个主要的release标签，我们都会提供对应版本的文档。</p>

<ul>
  <li><code class="highlighter-rouge">rancher/server:latest</code> 此标签是我们的最新一次开发的构建版本。这些构建已经被我们的CI框架自动验证测试。但这些release并不代表可以在生产环境部署。</li>
  <li><code class="highlighter-rouge">rancher/server:stable</code> 此标签是我们最新一个稳定的release构建。这个标签代表我们推荐在生产环境中使用的版本。</li>
</ul>

<p>请不要使用任何带有 <code class="highlighter-rouge">rc{n}</code> 前缀的release。这些构建都是Rancher团队的测试构建。</p>

<p><a id="single-container"></a></p>

<h3 id="rancher-server----non-ha">启动 Rancher Server - 单容器部署 (non-HA)</h3>

<p>在安装了Docker的Linux服务器上，使用一个简单的命令就可以启动一个单实例的Rancher。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run -d --restart<span class="o">=</span>unless-stopped -p 8080:8080 rancher/server
</code></pre>
</div>

<h3 id="rancher-ui">Rancher UI</h3>

<p>UI以及API会使用 <code class="highlighter-rouge">8080</code> 端口对外服务。下载Docker镜像完成后，需要1到2分钟的时间Rancher才能完全启动并提供服务。</p>

<p>访问如下的URL: <code class="highlighter-rouge">http://&lt;SERVER_IP&gt;:8080</code>。<code class="highlighter-rouge">&lt;SERVER_IP&gt;</code> 是运行Rancher Server的主机的公共IP地址。</p>

<p>当UI已经启动并运行，你可以先<a href="/docs/rancher/v1.6/zh/hosts/">添加主机</a> 或者在应用商店中选择一个容器编排引擎。在默认情况下，如果没有选择不同的容器编排引擎，当前环境会使用Cattle引擎。在主机被添加都Rancher中后，你可以开始添加<a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a>或者从<a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a>通过应用模版启动一个应用。</p>

<p><a id="single-container-external-database"></a></p>

<h3 id="rancher-server------">启动 Rancher Server - 单容器部署 - 使用外部数据库</h3>

<p>除了使用内部的数据库，你可以启动一个Rancher Server并使用一个外部的数据库。启动命令与之前一样，但添加了一些额外的参数去说明如何连接你的外部数据库。</p>

<blockquote>
  <p><strong>注意：</strong> 在你的外部数据库中，只需要提前创建数据库名和数据库用户。Rancher会自动创建Rancher所需要的数据库表。</p>
</blockquote>

<p>以下是创建数据库和数据库用户的SQL命令例子</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">cattle</span> <span class="k">COLLATE</span> <span class="o">=</span> <span class="s1">'utf8_general_ci'</span> <span class="n">CHARACTER</span> <span class="k">SET</span> <span class="o">=</span> <span class="s1">'utf8'</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="n">cattle</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'cattle'</span><span class="o">@</span><span class="s1">'%'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cattle'</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="n">cattle</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'cattle'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cattle'</span><span class="p">;</span>
</code></pre>
</div>

<p>启动一个Rancher连接一个外部数据库，你需要在启动容器的命令中添加额外参数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run -d --restart<span class="o">=</span>unless-stopped -p 8080:8080 rancher/server <span class="se">\</span>
    --db-host myhost.example.com --db-port 3306 --db-user username --db-pass password --db-name cattle
</code></pre>
</div>

<p>大部分的输入参数都有默认值并且是可选的，只有MySQL server的地址是必须输入的。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>--db-host               IP or hostname of MySQL server
--db-port               port of MySQL server <span class="o">(</span>default: 3306<span class="o">)</span>
--db-user               username <span class="k">for </span>MySQL login <span class="o">(</span>default: cattle<span class="o">)</span>
--db-pass               password <span class="k">for </span>MySQL login <span class="o">(</span>default: cattle<span class="o">)</span>
--db-name               MySQL database name to use <span class="o">(</span>default: cattle<span class="o">)</span>
</code></pre>
</div>

<p><br /></p>

<blockquote>
  <p><strong>注意：</strong> 在之前版本的Rancher Server中，我们需要使用环境变量去连接外部数据库。在新版本中，这些环境变量会继续生效，但Rancher建议使用命令参数代替。</p>
</blockquote>

<p><a id="single-container-bind-mount"></a></p>

<h3 id="rancher-server------mysql">启动 Rancher Server - 单容器部署 - 挂载MySQL数据库的数据目录</h3>

<p>在Rancher Server容器中，如果你想使用一个主机上的卷来持久化数据库，如下命令可以在启动Rancher时挂载MySQL的数据卷。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run -d -v &lt;host_vol&gt;:/var/lib/mysql --restart<span class="o">=</span>unless-stopped -p 8080:8080 rancher/server
</code></pre>
</div>
<p>使用这条命令，数据库就会持久化在主机上。如果你有一个现有的Rancher Server容器并且想挂在MySQL的数据卷，可以参考以下的<a href="/docs/rancher/v1.6/zh/upgrading/#single-container-bind-mount">Rancher升级</a>介绍。</p>

<p><a id="multi-nodes"></a></p>

<h3 id="rancher-server---ha">启动 Rancher Server - 多节点的HA部署</h3>

<p>在高可用(HA)的模式下运行Rancher Server与<a href="#启动-rancher-server---单容器部署---使用外部数据库">使用外部数据库运行Rancher Server</a>一样简单，需要暴露一个额外的端口，添加额外的参数到启动命令中，并且运行一个外部的负载均衡就可以了。</p>

<h4 id="ha">HA部署需求</h4>

<ul>
  <li>HA 节点:
    <ul>
      <li>所有安装有<a href="/docs/rancher/v1.6/zh/hosts/#docker版本适用对比">支持的Docker版本</a>的现代Linux发行版 <a href="http://docs.rancher.com/os/">RancherOS</a>, Ubuntu, RHEL/CentOS 7 都是经过严格的测试。
        <ul>
          <li>对于 RHEL/CentOS, 默认的 storage driver, 例如 devicemapper using loopback, 并不被<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#/storage-driver-options">Docker</a>推荐。 请参考Docker的文档去修改使用其他的storage driver。</li>
          <li>对于 RHEL/CentOS, 如果你想使用 SELinux, 你需要 <a href="/docs/rancher/v1.6/zh/installing-rancher/selinux/">安装额外的 SELinux 组件</a>.</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">9345</code>, <code class="highlighter-rouge">8080</code> 端口需要在各个节点之间能够互相访问</li>
      <li>1GB内存</li>
    </ul>
  </li>
  <li>MySQL数据库
    <ul>
      <li>至少 1 GB内存</li>
      <li>每个Rancher Server节点需要50个连接 (例如：3个节点的Rancher则需要至少150个连接)</li>
      <li>MYSQL配置要求
        <ul>
          <li>选项1: 用默认<code class="highlighter-rouge">COMPACT</code>选项运行Antelope</li>
          <li>选项2: 运行MySQL 5.7，使用Barracuda。默认选项<code class="highlighter-rouge">ROW_FORMAT</code>需设置成<code class="highlighter-rouge">Dynamic</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>外部负载均衡服务器
    <ul>
      <li>负载均衡服务器需要能访问Rancher Server节点的 <code class="highlighter-rouge">8080</code> 端口</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>注意：</strong> 目前Rancher中并不支持Docker for Mac</p>
</blockquote>

<h4 id="section-1">大规模部署建议</h4>

<ul>
  <li>每一个Rancher Server节点需要有4 GB 或者8 GB的堆空间，意味着需要8 GB或者16 GB内存</li>
  <li>MySQL数据库需要有高性能磁盘</li>
  <li>对于一个完整的HA，建议使用一个有副本的Mysql数据库。另一种选择则是使用Galera集群并强制写入一个MySQL节点。</li>
</ul>

<ol>
  <li>
    <p>在每个需要加入Rancher Server HA集群的节点上，运行以下命令：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Launch on each node in your HA cluster</span>
<span class="gp">$ </span>docker run -d --restart<span class="o">=</span>unless-stopped -p 8080:8080 -p 9345:9345 rancher/server <span class="se">\</span>
     --db-host myhost.example.com --db-port 3306 --db-user username --db-pass password --db-name cattle <span class="se">\</span>
     --advertise-address &lt;IP_of_the_Node&gt;
</code></pre>
    </div>

    <p>在每个节点上，<code class="highlighter-rouge">&lt;IP_of_the_Node&gt;</code> 需要在每个节点上唯一，因为这个IP会被添加到HA的设置中。</p>

    <p>如果你修改了 <code class="highlighter-rouge">-p 8080:8080</code> 并在host上暴露了一个不一样的端口，你需要添加 <code class="highlighter-rouge">--advertise-http-port &lt;host_port&gt;</code> 参数到命令中。</p>

    <blockquote>
      <p><strong>注意：</strong> 你可以使用 <code class="highlighter-rouge">docker run rancher/server --help</code> 获得命令的帮助信息</p>
    </blockquote>
  </li>
  <li>
    <p>配置一个外部的负载均衡器，这个负责均衡负责将例如<code class="highlighter-rouge">80</code>或<code class="highlighter-rouge">443</code>端口的流量，转发到运行Rancher Server的节点的<code class="highlighter-rouge">8080</code>端口中。负载均衡器必须支持websockets 以及 forwarded-for 的Http请求头以支持Rancher的功能。参考 <a href="/docs/rancher/v1.6/zh//installing-rancher/installing-server/basic-ssl-config/">使用SSL</a> 这个配置的例子。</p>
  </li>
</ol>

<h4 id="advertise-address">advertise-address选项</h4>

<table>
  <thead>
    <tr>
      <th>选项</th>
      <th>例子</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>IP address</td>
      <td><code class="highlighter-rouge">--advertise-address 192.168.100.100</code></td>
      <td>使用指定IP</td>
    </tr>
    <tr>
      <td>Interface</td>
      <td><code class="highlighter-rouge">--advertise-address eth0</code></td>
      <td>从指定网络接口获取</td>
    </tr>
    <tr>
      <td>awslocal</td>
      <td><code class="highlighter-rouge">--advertise-address awslocal</code></td>
      <td>从这里获取<code class="highlighter-rouge">http://169.254.169.254/latest/meta-data/local-ipv4</code></td>
    </tr>
    <tr>
      <td>ipify</td>
      <td><code class="highlighter-rouge">--advertise-address ipify</code></td>
      <td>从这里获取<code class="highlighter-rouge">https://api.ipify.org</code></td>
    </tr>
  </tbody>
</table>

<h4 id="harancher-server">HA模式下的Rancher Server节点</h4>

<p>如果你的Rancher Server节点上的IP修改了，你的节点将不再存在于Rancher HA集群中。你必须停止在<code class="highlighter-rouge">--advertise-address</code>配置了不正确IP的Rancher Server容器并启动一个使用正确IP地址的Rancher Server的容器。</p>

<p><a id="elb"></a></p>

<h3 id="awselasticclassic-load-balancerrancher-server-ha">使用AWS的Elastic/Classic Load Balancer作为Rancher Server HA的负载均衡器</h3>

<p>我们建议使用AWS的ELB作为你Rancher Server的负载均衡器。为了让ELB与Rancher的websockets正常工作，你需要开启proxy protocol模式并且保证HTTP support被停用。 默认的，ELB是在HTTP/HTTPS模式启用，在这个模式下不支持websockets。需要特别注意listener的配置。</p>

<p>如果你在配置ELB中遇到问题，我们建议你参考<a href="#使用terraform进行配置">terraform version</a>。</p>

<blockquote>
  <p><strong>注意：</strong> 如果你正在使用自签名的证书, 请参考我们SSL部分里的<a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#elb">如何在AWS里配置ELB</a>.</p>
</blockquote>

<h4 id="listener----plaintext">Listener 配置 - Plaintext</h4>

<p>简单的来说，使用非加密的负载均衡，需要以下的listener配置：</p>

<table>
  <thead>
    <tr>
      <th>Configuration Type</th>
      <th>Load Balancer Protocol</th>
      <th>Load Balancer Port</th>
      <th>Instance Protocol</th>
      <th>Instance Port</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Plaintext</td>
      <td>TCP</td>
      <td>80</td>
      <td>TCP</td>
      <td>8080  (或者使用启动Rancher Server时 <code class="highlighter-rouge">--advertise-http-port</code> 指定的端口)</td>
    </tr>
  </tbody>
</table>

<h4 id="proxy-protocol">启用 Proxy Protocol</h4>

<p>为了使websockets正常工作，ELB的proxy protocol policy必须被启用。</p>

<ul>
  <li>启用 <a href="http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/enable-proxy-protocol.html">proxy protocol</a> 模式</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ aws elb create-load-balancer-policy --load-balancer-name &lt;LB_NAME&gt; --policy-name &lt;POLICY_NAME&gt; --policy-type-name ProxyProtocolPolicyType --policy-attributes AttributeName=ProxyProtocol,AttributeValue=true
$ aws elb set-load-balancer-policies-for-backend-server --load-balancer-name &lt;LB_NAME&gt; --instance-port 443 --policy-names &lt;POLICY_NAME&gt;
$ aws elb set-load-balancer-policies-for-backend-server --load-balancer-name &lt;LB_NAME&gt; --instance-port 8080 --policy-names &lt;POLICY_NAME&gt;
</code></pre>
</div>

<ul>
  <li>Health check可以配置使用HTTP:8080下的 <code class="highlighter-rouge">/ping</code> 路径进行健康检查</li>
</ul>

<h4 id="terraform">使用Terraform进行配置</h4>

<p>以下是使用Terraform配置的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>resource "aws_elb" "lb" {
  name               = "&lt;LB_NAME&gt;"
  availability_zones = ["us-west-2a","us-west-2b","us-west-2c"]
  security_groups = ["&lt;SG_ID&gt;"]

  listener {
    instance_port     = 8080
    instance_protocol = "tcp"
    lb_port           = 443
    lb_protocol       = "ssl"
    ssl_certificate_id = "&lt;IAM_PATH_TO_CERT&gt;"
  }

}

resource "aws_proxy_protocol_policy" "websockets" {
  load_balancer  = "${aws_elb.lb.name}"
  instance_ports = ["8080"]
}
</code></pre>
</div>

<p><a id="alb"></a></p>

<h3 id="awsapplication-load-balanceralb-rancher-server-ha">使用AWS的Application Load Balancer(ALB) 作为Rancher Server HA的负载均衡器</h3>

<p>我们不再推荐使用AWS的Application Load Balancer (ALB)替代Elastic/Classic Load Balancer (ELB)。如果你依然选择使用ALB，你需要直接指定流量到Rancher Server节点上的HTTP端口，默认是8080。</p>

<p><a id="ldap"></a></p>

<h3 id="tlsadopenldap">使用TLS认证的AD/OPENLDAP</h3>

<p>为了在Rancher Server上启用Active Directory或OpenLDAP并使用TLS，Rancher Server容器在启动的时候需要配置LDAP证书，证书是LDAP服务提供方提供。证书保存在需要运行Rancher Server的Linux机器上。</p>

<p>启动Rancher并挂载证书。证书在容器内部 <strong>必须</strong> 命名为<code class="highlighter-rouge">ca.crt</code>。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run -d --restart<span class="o">=</span>unless-stopped -p 8080:8080 <span class="se">\</span>
  -v /some/dir/cert.crt:/var/lib/rancher/etc/ssl/ca.crt rancher/server
</code></pre>
</div>

<p>你可以使用Rancher Server的日志检查传入的 <code class="highlighter-rouge">ca.crt</code> 证书是否生效</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>docker logs &lt;SERVER_CONTAINER_ID&gt;
</code></pre>
</div>

<p>在日志的开头，会显示证书已经被正确加载的信息。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Adding ca.crt to Certs.
Updating certificates <span class="k">in</span> /etc/ssl/certs... 1 added, 0 removed; <span class="k">done</span>.
Running hooks <span class="k">in</span> /etc/ca-certificates/update.d....done.
Certificate was added to keystore
</code></pre>
</div>

<p><a id="http-proxy"></a></p>

<h3 id="http-rancher-server">在HTTP代理后方启动 Rancher Server</h3>

<p>为了设置HTTP Proxy，Docker守护进程需要修改配置并指向这个代理。在启动Rancher Server前，需要编辑配置文件 <code class="highlighter-rouge">/etc/default/docker</code> 添加你的代理信息并重启Docker服务。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo vi /etc/default/docker
</code></pre>
</div>

<p>在文件中，编辑 <code class="highlighter-rouge">#export http_proxy="http://127.0.0.1:3128/"</code> 并修改它指向你的代理。保存修改并重启Docker。重启Docker的方式在每个OS上都不一样。</p>

<blockquote>
  <p><strong>注意：</strong> 如果你使用systemd运行Docker, 请参考Docker官方的<a href="https://docs.docker.com/articles/systemd/#http-proxy">文档</a> 去配置http proxy设置。</p>
</blockquote>

<p>为了使得<a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a>加载正常，HTTP代理设置必须在Rancher Server运行的环境变量中。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run -d <span class="se">\</span>
    -e <span class="nv">http_proxy</span><span class="o">=</span>&lt;proxyURL&gt; <span class="se">\</span>
    -e <span class="nv">https_proxy</span><span class="o">=</span>&lt;proxyURL&gt; <span class="se">\</span>
    -e <span class="nv">no_proxy</span><span class="o">=</span><span class="s2">"localhost,127.0.0.1"</span> <span class="se">\</span>
    -e <span class="nv">NO_PROXY</span><span class="o">=</span><span class="s2">"localhost,127.0.0.1"</span> <span class="se">\</span>
    --restart<span class="o">=</span>unless-stopped -p 8080:8080 rancher/server
</code></pre>
</div>

<p>如果你不使用<a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a>，则使用你平常的Rancher Server命令即可。</p>

<p>当向Rancher<a href="/docs/rancher/v1.6/zh/hosts/">添加主机</a>时，在HTTP代理中不需要额外的设置和要求。</p>

<p><a id="mysql-ssl"></a></p>

<h3 id="sslmysqlrancher-server">通过SSL连接MySQL的Rancher Server</h3>
<blockquote>
  <p><strong>注意：</strong> 目前在Rancher 1.6.3以上版本才支持</p>
</blockquote>

<h3 id="section-2">重要提示</h3>

<p>如果你正在使用LDAP或者AD认证方式，并且这些认证方式的证书发放方CA并不是MySQL服务器SSL的证书发放方CA，这篇指南无法适用于你的情况。</p>

<h3 id="section-3">前提条件</h3>

<ul>
  <li>MySQL服务器的证书或CA证书</li>
</ul>

<h3 id="section-4">步骤</h3>

<ol>
  <li>拷贝MySQL服务器的证书或CA证书到Rancher Server的主机上。当启动<code class="highlighter-rouge">rancher/server</code>容器的时候你必须将证书挂载到<code class="highlighter-rouge">/var/lib/rancher/etc/ssl/ca.crt</code>。</li>
  <li>更改以下的模板的对应参数，构建一个JDBC URL:<br />
<code class="highlighter-rouge">
jdbc:mysql://&lt;DB_HOST&gt;:&lt;DB_PORT&gt;/&lt;DB_NAME&gt;?useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;prepStmtCacheSize=517&amp;cachePrepStmts=true&amp;prepStmtCacheSqlLimit=4096&amp;socketTimeout=60000&amp;connectTimeout=60000&amp;sslServerCert=/var/lib/rancher/etc/ssl/ca.crt&amp;useSSL=true
</code></li>
  <li>使用环境变量<code class="highlighter-rouge">CATTLE_DB_CATTLE_MYSQL_URL</code>和<code class="highlighter-rouge">CATTLE_DB_LIQUIBASE_MYSQL_URL</code>来导入上面的JDBC URL到容器里面。</li>
  <li>加入环境变量<code class="highlighter-rouge">CATTLE_DB_CATTLE_GO_PARAMS="tls=true"</code>到容器里面。但是如果服务器证书的标题名字不符合服务器的主机名，你需要使用的是<code class="highlighter-rouge">CATTLE_DB_CATTLE_GO_PARAMS="tls=skip-verify"</code>.</li>
</ol>

<h4 id="section-5">例子</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="gp">$ </span><span class="nb">export </span><span class="nv">JDBC_URL</span><span class="o">=</span><span class="s2">"jdbc:mysql://&lt;DB_HOST&gt;:&lt;DB_PORT&gt;/&lt;DB_NAME&gt;?useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;prepStmtCacheSize=517&amp;cachePrepStmts=true&amp;prepStmtCacheSqlLimit=4096&amp;socketTimeout=60000&amp;connectTimeout=60000&amp;sslServerCert=/var/lib/rancher/etc/ssl/ca.crt&amp;useSSL=true"</span>

<span class="gp">$ </span>cat <span class="sh">&lt;&lt;EOF &gt; docker-compose.yml
version: '2'
  services:
    rancher-server:
      image: rancher/server:stable
      restart: unless-stopped
      command: --db-host &lt;DB_HOST&gt; --db-port &lt;DB_PORT&gt; --db-name &lt;DB_NAME&gt; --db-user &lt;DB_USER&gt; --db-pass &lt;DB_PASS&gt;
      environment:
        CATTLE_DB_LIQUIBASE_MYSQL_URL: $JDBC_URL
        CATTLE_DB_CATTLE_MYSQL_URL: $JDBC_URL
        CATTLE_DB_CATTLE_GO_PARAMS: "tls=true"
      volumes:
        - /path/to/mysql/ca.crt:/var/lib/rancher/etc/ssl/ca.crt
      ports:
        - "8080:8080"
EOF

</span><span class="gp">$ </span>docker-compose up -d
</code></pre>
</div>

<p><em>重要</em>: 你必须在两个环境变量里都写入构建好的JDBC_URL，还必须加入<code class="highlighter-rouge">--db-xxx</code>参数!</p>

    </div>
</div>
</div>
</div>

<div class="row wrap">
<a class="btn btn-primary pull-right" href="https://github.com/rancher/rancher.github.io/tree/master/rancher/latest/zh/installing-rancher/installing-server/index.md">Edit this page <i class="fa fa-pencil"></i></a>
</div>

<footer class="clearfix">
  <div class="wrap">
    <div class=""><!--bottom footer-->
      <div class="row">
          <div class="col span-6">
              <ul id="menu-footer" class="list-inline">
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="About Rancher Labs" href="http://rancher.com/about/">About Rancher Labs</a></li>
                  <li id="menu-item-11352" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11352"><a title="Contact" href="http://rancher.com/contact/">Contact</a></li>
                  <li id="menu-item-14152" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14152"><a title="Privacy" href="http://rancher.com/privacy/">Privacy</a></li>
                  <li id="menu-item-15635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-15635"><a title="Careers" href="http://rancher.com/careers/">Careers</a></li>
                  
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="English Docs" href="https://rancher.com/docs/rancher/latest/en/">English Docs</a></li>
                  
              </ul>
              <p>Copyright &copy; 2014-2017 <a href="http://rancher.com">Rancher Labs</a>. All Rights Reserved.</p>
          </div>
          <div class="col span-6 text-right">
              <ul class="list-inline">
                  <li><a href="https://github.com/rancher/rancher" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-github.png" alt="Rancher Labs GitHub"></a></li>
                  <li><a href="https://twitter.com/Rancher_Labs" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-twitter.png" alt="Rancher Labs Twitter"></a></li>
                  <li><a href="https://slack.rancher.io/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-slack.png" alt="Rancher Labs Slack"></a></li>
                  <li><a href="https://www.linkedin.com/groups/6977008/profile" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-linkedin.png" alt="Rancher Labs LinkedIn"></a></li>
                  <li><a href="https://www.facebook.com/rancherlabs/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-fb.png" alt="Rancher Labs Facebook"></a></li>
              </ul>
          </div>
      </div>
    </div><!--bottom footer-->
    </div>
</footer>
<script src="/docs/vendor/jquery.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/jquery.slicknav.min.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/rancher-docs.js?t=2017-12-04 13:23:19 -0800"></script>
<!-- Start of Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-56382716-3', 'auto');
ga('send', 'pageview');
</script>
<!-- End of Google Analytics -->
<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d, s, i, r) {
    if (d.getElementById(i)) { return; }
    var n = d.createElement(s),
        e = d.getElementsByTagName(s)[0];
    n.id = i;
    n.src = '//js.hs-analytics.net/analytics/' + (Math.ceil(new Date() / r) * r) + '/468859.js';
    e.parentNode.insertBefore(n, e);
})(document, "script", "hs-analytics", 300000);
</script>
<!-- End of Async HubSpot Analytics Code -->
</body>

</html>

