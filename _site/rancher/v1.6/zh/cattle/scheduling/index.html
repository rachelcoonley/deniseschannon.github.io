<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Scheduling Services in Cattle Environments</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for Rancher">
    <link href="/docs/favicon.png" rel="shortcut icon" type="image/png" sizes="16x16">
    <link href="/docs/css/syntax.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/font-awesome/css/font-awesome.min.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/vendor/lato/lato.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/lacsso.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/slicknav.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
    <link href="/docs/css/rancher-docs.css?t=2017-12-04 13:23:19 -0800" rel="stylesheet">
</head>

<body class="bg-default">
    <div class="row body">
    <header class="page-header">
      <div class="wrap clearfix">
        <nav role="navigation" id="js-responsive-nav" class="clearfix responsive-nav"><a class="nav-toggle"></a>
          <a class="nav-logo logo-caas btn bg-transparent"><img src="/docs/img/rancher-logo-nopadding.svg" class="img-responsive" alt="Rancher" data-pin-nopin="true"></a>
          <ul class="nav-main nav-list">
            <li><a href="http://rancher.com/">Back to Rancher.com</a></li>

            <ul class="nav navbar-nav pull-right">
              <li><a href="https://github.com/rancher/rancher#installation" id="rnchrdm-nav-download" title="Download Rancher" target="_blank"><img src="/docs/img/header-download.svg" alt="Download Rancher" height="12" width="14"> Download Rancher</a></li>
              <li><a href="http://rancher.com/support" id="rnchrdm-nav-reqsupport" title="Request Support"><i class="fa fa-question-circle" aria-hidden="true"></i>
 Request Support</a></li>
            </ul>
          </ul>
      </nav>
    </div>
    <h1>Rancher Docs</h1>
  </header>
  <div class="clearfix"></div>
  <div class="wrap clearfix">
        <div class="col span-3 mt-0 mr-0 sidebar">
        <!--Start Google Search-->
              <div class="gcse-search" id="google-search"></div>
              <script>
              var match = window.location.pathname.match(/\/rancher\/([^\/]+)/);
              if (match) {
                  document.getElementById('google-search').setAttribute('data-defaultToRefinement', match[1]);
              }

              (function() {
                  var cx = '007896692384436596364:60akf3bfmxm';
                  var gcse = document.createElement('script');
                  gcse.type = 'text/javascript';
                  gcse.async = true;
                  gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                  var s = document.getElementsByTagName('script')[0];
                  s.parentNode.insertBefore(gcse, s);
              })();
              </script>
              <!--End Google Search-->

<ul id="menu">
    <li><a href="/docs/rancher/v1.6/zh/">简介</a></li>
    <li><a href="/docs/rancher/v1.6/zh/quick-start-guide/">快速开始</a></li>
    <li>
        <a href="#">安装Rancher<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/">安装 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#安装需求">安装需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#rancher-server-标签">Rancher Server标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署-non-ha">启动 Rancher Server - 单容器部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---多节点的ha部署">启动 Rancher Server - 多节点的HA部署</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#ha部署需求">HA部署需求</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---使用外部数据库">启动 Rancher Server - 单容器部署 - 使用外部数据库</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#启动-rancher-server---单容器部署---挂载mysql数据库的数据目录">启动 Rancher Server - 单容器部署 - 挂载MYSQL数据库的数据目录</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#使用aws的elasticclassic-load-balancer作为rancher-server-ha的负载均衡器">使用AWS的ELB作为HA的负载均衡器</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#tls认证使用adopenldap">使用TLS认证的AD/OPENLDAP</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/#在http代理后方启动-rancher-server">在HTTP代理后启动 Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/zh/installing-rancher/selinux/">在SELinux模式下使用Rancher</a></li>
          <li>
               <a href="#">安装Rancher并使用SSL<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#需求">需求</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#nginx-配置模版">NGINX配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#apache-配置例子">Apache配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#haproxy-配置例子">HAProxy配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用aws的elastic-load-balancer作为rancher-server-ha的负载均衡器并使用ssl">使用AWS的ELB作为HA的负载均衡器并使用SSL</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#f5-big-ip配置示例">F5 BIG-IP配置示例</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/basic-ssl-config/#使用自签名证书-beta">使用自签名证书</a></li>
               </ul>
          </li>
          <li>
               <a href="#">内网启动Rancher<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用私有镜像仓库">使用私有镜像仓库</a></li>
                 <li><a href="/docs/rancher/v1.6/zh/installing-rancher/installing-server/no-internet-access/#使用http代理">使用HTTP代理</a></li>
               </ul>
          </li>
        </ul>
    </li>
    <li>
         <a href="#">升级Rancher Server<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/">升级Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#rancher-server-tags">Rancher Server标签</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#基础设施服务]">升级基础设施服务</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#升级ha架构">升级HA架构的Rancher Server</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---外部数据库">升级非HA模式的Rancher Server - 外部数据库</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#单独升级一个容器non-ha---绑定挂载的mysql卷">升级非HA模式的Rancher Server - 绑定挂载的MYSQL卷</a></li>
           <li><a href="/docs/rancher/v1.6/zh/upgrading/#没有互联网访问的rancher服务器">升级内网中的Rancher Server</a></li>
        </ul>
     </li>
    <li>
         <a href="#">系统设置<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li>
                <a href="#">访问控制方式<i class="pull-right fa fa-angle-down"></i></a>
                <ul>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#活动目录">Active Directory</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#azure-ad">Azure AD</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#github">Github</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#本地身份认证">本地身份认证</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#openldap">OpenLDAP</a></li>
                  <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#shibboleth">Shibboleth</a></li>
                </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#访问控制">访问控制</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/access-control/#限制并发登陆">限制并发登陆</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/accounts/">账户</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#主机注册">注册主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/settings/#应用商店">应用商店</a></li>
          <li><a href="/docs/rancher/v1.6/zh/configuration/machine-drivers/">主机驱动</a></li>
        </ul>
    </li>
    <li>
          <a href="#">环境<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
            <li><a href="/docs/rancher/v1.6/zh/environments/">环境管理</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#什么是环境模版">环境模版</a></li>
            <li><a href="/docs/rancher/v1.6/zh/environments/#成员角色">环境中的角色</a></li>
          </ul>
    </li>
    <li>
        <a href="#">主机<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/zh/hosts/">主机简介</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#docker版本适用对比">支持的Docker版本</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机标签">主机标签</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#主机调度地址">主机调度地址</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在代理后的主机">在代理后的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/custom/">添加自定义主机</a></li>
          <li>
              <a href="#">添加云主机<i class="pull-right fa fa-angle-down"></i></a>
              <ul>
                <li><a href="/docs/rancher/v1.6/zh/hosts/amazon/">添加Amazon EC2主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/azure/">添加Azure主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/digitalocean/">添加DigitalOcean主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/exoscale/">添加Exoscale主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/packet/">添加Packet主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/rackspace/">添加Rackspace主机</a></li>
                <li><a href="/docs/rancher/v1.6/zh/hosts/other/">添加其他云服务商的主机</a></li>
              </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#访问云提供商的主机">访问云提供商的主机</a></li>
          <li><a href="/docs/rancher/v1.6/zh/hosts/#在rancher内删除主机">删除主机</a></li>
        </ul>
    </li>
    <li>
      <a href="#">镜像仓库<i class="pull-right fa fa-angle-down"></i></a>
      <ul>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/">镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#不安全的镜像库">不安全的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#自签名证书">自签名证书</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用亚马逊的ecr镜像库">使用亚马逊的ECR镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#使用google容器镜像仓库">使用Google容器镜像仓库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#更改默认的镜像库">更改默认的镜像库</a></li>
        <li><a href="/docs/rancher/v1.6/zh/environments/registries/#限制镜像库的使用">限制镜像库的使用</a></li>
      </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/environments/certificates/">证书</a></li>
    <li>
      <a href="#">系统服务<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/">基础设施服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/networking/">网络</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/network-policy/">网络策略</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/load-balancer">负载均衡器</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/dns-service/">DNS服务</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/metadata-service/">Metadata服务</a></li>
              <li>
                  <a href="#">存储服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/">存储服务</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-nfs/">Rancher NFS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/storage-service/rancher-ebs/">Rancher EBS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/">调度器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#多ip主机调度">多IP主机调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#基于资源约束的调度">基于资源约束的调度</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#在主机上调度指定服务">在主机上调度指定服务</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/audit-log/">审计日志</a></li>
              <li><a href="/docs/rancher/v1.6/zh/rancher-services/service-accounts/">服务账号</a></li>
           </ul>
    </li>
    <li>
          <a href="#">Cattle<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
                <li><a href="/docs/rancher/v1.6/zh/cattle/stacks/">应用</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/volumes/">卷</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a></li>
                <li>
                    <a href="#">在UI中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#如何在ui上新增一个负载均衡">添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#服务规则">服务规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#选择器规则">选择器规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止">SSL会话终止</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#负载均衡的会话粘性">负载均衡的会话粘性</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义haproxycfg">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#标签调度负载均衡">标签调度负载均衡</a></li>
                      </ul>
                </li>
                <li>
                    <a href="#">在CLI和Compose中配置负载均衡<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#用rancher-compose-添加负载均衡">用Rancher Compose 添加负载均衡</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#源端口">源端口</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#端口规则">端口规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#证书">证书</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#自定义配置">自定义HAProxy配置</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#会话粘性策略">会话粘性策略</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#load-balancer-example-l7">七层负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#内部负载均衡例子">内部负载均衡示例</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/#ssl会话终止-example">SSL会话终止示例</a></li>
                      </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-external-services/">外部服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/adding-service-alias/">服务别名</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/health-checks/">健康检查</a></li>
                <li>
                    <a href="#">调度服务<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/">调度</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在ui中添加标签">在UI中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#在rancher-compose中添加标签">在Rancher Compose中设置调度规则</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/scheduling/#调度标签表">调度标签表</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/upgrading/">升级服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/internal-dns-service/">Cattle环境中的内部DNS服务</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/external-dns-service/">外部DNS服务</a></li>
                <li>
                    <a href="#">Rancher-Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/">Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/commands/">指令与参数</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/environment-interpolation/">环境插值</a></li>
                        <li><a href="/docs/rancher/v1.6/zh/cattle/rancher-compose/build/">使用AWS S3构建镜像</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/secrets/">密文 - 实验性的</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/webhook-service/">Webhooks</a></li>
                <li><a href="/docs/rancher/v1.6/zh/cattle/labels/">标签</a></li>
          </ul>
    </li>
    <li>
          <a href="#">Kubernetes<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/">启动Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/resiliency-planes/">弹性平面</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/providers/">Cloud Providers</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/private-registry/">私有镜像仓库</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/rbac/">RBAC</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/disaster-recovery/">灾难恢复</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/backups/">备份</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/storage/">持久化存储</a></li>
              <li>
                  <a href="#">插件支持<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/">插件支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#helm">Helm</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/addons/#skydns">SkyDNS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">Ingress支持与配置<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/">Ingress支持</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#基于主机路由配置-ingress-资源">基于主机路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#使用基于路径的路由配置ingress资源">使用基于路径的路由配置Ingress资源</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例两个负载均衡器使用交替的端口">多个负载均衡器使用不同的端口</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例使用tls">使用 TLS</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#禁用http">禁用HTTP</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例用户定制">示例用户定制</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在所有主机上运行负载均衡器">所有主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在特定主机上运行负载均衡器">特定主机运行负载均衡器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#例将流量导向同一主机上的不同容器">将流量导向同一主机上的不同容器</a></li>
                      <li><a href="/docs/rancher/v1.6/zh/kubernetes/ingress/#示例在同一主机上对容器的流量进行优先级排序">在同一主机上对容器的流量进行优先级排序</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/upgrading/">升级Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/zh/kubernetes/deleting/">删除Kubernetes</a></li>

          </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/zh/mesos/">Mesos</a></li>
    <li><a href="/docs/rancher/v1.6/zh/swarm/">Swarm - 实验性的 </a></li>
    <li><a href="/docs/rancher/v1.6/zh/windows/">Windows - 实验性的</a></li>
    <li><a href="/docs/rancher/v1.6/zh/native-docker/">以原生Docker命令行的形式使用Rancher</a></li>
    <li>
            <a href="#">应用商店<i class="pull-right fa fa-angle-down"></i></a>
            <ul>
                <li><a href="/docs/rancher/v1.6/zh/catalog/">应用商店</a></li>
                <li><a href="/docs/rancher/v1.6/zh/catalog/private-catalog/">创建私有应用商店</a></li>
            </ul>
        </li>
    <li><a href="#">Rancher命令行<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/cli/">Rancher命令行</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/commands/">命令和选项</a></li>
            <li><a href="/docs/rancher/v1.6/zh/cli/variable-interpolation/">变量替换</a></li>
        </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/api/v2-beta/">API文档</a></li>
    <li><a href="/docs/rancher/v1.6/zh/contributing/">Rancher社区贡献</a></li>
    <li>
        <a href="#">常见问题<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/zh/faqs/server/">Rancher Server的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/agents/">Rancher Agent的常见问题</a></li>
            <li><a href="/docs/rancher/v1.6/zh/faqs/troubleshooting/">常见的故障排查与修复方法</a></li>
        </ul>
    </li>
    <li>
        <a href="#" class="btn-docs">历史文档<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.5/zh/">Rancher v1.5</a></li>
            <li><a href="/docs/rancher/v1.4/zh/">Rancher v1.4</a></li>
            <li><a href="/docs/rancher/v1.3/zh/">Rancher v1.3</a></li>
            <li><a href="/docs/rancher/v1.2/zh/">Rancher v1.2</a></li>
            <li><a href="/docs/rancher/v1.1/zh/">Rancher v1.1</a></li>
            <li><a href="/docs/rancher/v1.0/en/">Rancher v1.0</a></li>
        </ul>
    </li>
</ul>

</div>
<div class="col span-9">
    <div class="content-container">
        <h2 id="section">服务调度</h2>
<hr />

<p>在Rancher中，你可以根据严格或宽松的关联与斥关联规则，在特定主机上安排服务。 这些规则可以比较主机上的标签或主机上容器上的标签，以确定容器应该安排在哪个主机上。</p>

<p>默认情况下，Rancher将检测主机上的端口冲突，如果端口不可用，则不会将需要此端口的容器调度到这一主机上。</p>

<p>这个核心调度逻辑内置于Rancher，但Rancher还支持位于我们<a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/">外部调度器</a>中的其他调度能力，这是我们<a href="/docs/rancher/v1.6/zh/rancher-services/">基础设施服务</a>的一部分。其他调度能力包括：</p>

<ul>
  <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#multiple-ips">多个IP的主机调度能力</a></li>
  <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#resource-constraints">基于资源约束的调度能力 (例如 CPU和内存)</a></li>
  <li><a href="/docs/rancher/v1.6/zh/rancher-services/scheduler/#restrict-services-on-host">能够限制在主机上安排哪些服务</a></li>
</ul>

<h3 id="section-1">标签和调度规则</h3>

<p>不管是通过<a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a>或者<a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a>来创建容器时，我们都提供了为容器创建标签的选项，并且可以安排你想要放置容器的主机。 对于本节的剩余部分，我们将使用服务这个术语，但这些标签也适用于负载均衡器（即特定类型的服务）</p>

<p>调度规则提供了让Rancher选择要使用哪个主机的灵活性。 在Rancher中，我们使用标签来帮助定义调度规则。 你可以根据需要在容器上创建任意数量的标签。 通过多个调度规则，你可以完全控制容器在哪些主机上创建。 你可以要求在具有特定主机标签，容器标签或名称或特定服务的主机上启动该容器。 这些调度规则可以帮助你创建容器对主机的黑名单和白名单。</p>

<h3 id="ui">在UI中添加标签</h3>

<p>对于<a href="/docs/rancher/v1.6/zh/cattle/adding-services/">添加服务</a>，可以在<code class="highlighter-rouge">标签</code>选项卡中添加标签。 对于添加负载均衡，也可以在<code class="highlighter-rouge">标签</code>选项卡中找到添加标签。</p>

<p>通过向<a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a>添加标签，每个负载均衡容器将接收该标签，该标签是一个键值对。 在Rancher中，我们使用这些容器标签来帮助定义调度规则。 你可以根据需要在负载均衡上创建任意数量的标签。 默认情况下，Rancher已经在每个容器上添加了系统相关的标签。</p>

<h3 id="ui-1">在UI中调度选项</h3>

<p>对于<a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a>和<a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a>，标签可以在<strong>调度</strong>选项卡中找到。</p>

<p>对于 <a href="/docs/rancher/v1.6/zh/cattle/adding-services/">服务</a>,<br />
我们提供了两个选项来确定在哪里启动容器。</p>

<h4 id="section-2">选项1：在指定主机上运行 <em>全部</em> 容器</h4>

<p>通过选择此选项，容器/服务将在特定主机上启动。 如果你的主机掉线，则容器也将离线。 如果你从容器页面创建一个容器，即使有端口冲突，容器也将被启动。 如果创建一个数量大于1且服务端口冲突的服务，则你的服务可能会停留在 <em>Activating</em> 状态，直到你编辑正确的服务数量为止。</p>

<h4 id="section-3">选项2：为每一个容器自动选择符合调度规则的主机</h4>
<p>通过选择此选项，你可以灵活地选择调度规则。 遵循所有规则的任何主机都是可以启动容器的主机。 你可以通过点击 <strong>+</strong> 按钮添加规则。</p>

<p>对于<a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">负载均衡</a>，只有选项2可用，因为端口冲突。 你只能添加调度规则。 点击 <strong>调度</strong> 选项卡。 你可以通过点击 <strong>添加调度规则</strong> 按钮添加任意数量的调度规则。</p>

<p>对于每个规则，你可以选择规则的<strong>条件</strong>。 有四种不同的条件，它们定义了遵守规则的严格程度。 <strong>字段</strong>确定要应用规则的字段。 <strong>键</strong>和<strong>值</strong>是要检查字段的值。 如果你启动了一个服务或负载均衡，Rancher将根据每个主机的负载来扩展容器在适用主机上的分发。 根据所选择的条件将确定适用的主机是什么。</p>

<blockquote>
  <p><strong>注意：</strong> 对于<a href="/docs/rancher/v1.6/zh/cattle/adding-services/">添加服务</a>/<a href="/docs/rancher/v1.6/zh/cattle/adding-load-balancers/">添加负载均衡</a>，如果你在数量那里选择了 <strong>总是在每台主机上运行一个此容器的实例</strong>，则只有主机标签将显示为可能的字段。</p>
</blockquote>

<h4 id="section-4">条件</h4>

<ul>
  <li><strong>必须</strong> 或 <strong>不能</strong>：Rancher只会使用与字段和值匹配或不匹配的主机。 如果Rancher找不到符合这些条件的所有规则的主机，你的服务可能会停留在 <em>Activating</em> 状态。 该服务将不断尝试找到容器的主机。 要修复此状态，你可以编辑服务的数量或添加/编辑将满足所有这些规则的其他主机。</li>
  <li><strong>应该</strong>或<strong>不应该</strong>：Rancher将尝试使用匹配字段和值的主机。 在没有匹配所有规则的主机的情况下，Rancher将逐个删除软约束（应该/不应该规则），直到主机满足剩余的约束。</li>
</ul>

<h4 id="section-5">字段</h4>

<ul>
  <li><strong>主机标签</strong>：当选择要用于容器/服务的主机时，Rancher将检查主机上的标签，看它们是否与提供的键/值对匹配。 由于每个主机都可以有一个或多个标签，所以Rancher会将键/值对与主机上的所有标签进行比较。 将主机添加到Rancher时，可以向主机添加标签。 你还可以使用主机下拉菜单中的<strong>编辑</strong>选项来编辑主机上的标签。 活动主机上的标签列表可从关键字段的下拉列表中找到。</li>
  <li><strong>容器标签</strong>：选择此字段时，Rancher会查找已经具有与键/值对匹配的标签的容器的主机。 由于每个容器都可以有一个或多个标签，所以Rancher会将键/值对与主机中每个容器上的所有标签进行比较。 容器标签位于容器的<code class="highlighter-rouge">标签</code>选项中。 在容器启动后，你将无法编辑容器标签。 为了创建具有相同设置的新容器，你可以<strong>克隆</strong>容器或服务，并在启动之前添加标签。 运行容器上的用户标签列表可从关键字段的下拉列表中找到。</li>
  <li><strong>服务名称</strong>: Rancher将检查主机上是否有一个具有特定名称的服务。 如果在稍后的时间，该服务名称将更改或不活动/已删除，该规则将不再有效。 如果你选择此字段，则该值将需要以<code class="highlighter-rouge">应用名称/服务名称</code>的格式。 运行服务的列表可从值字段的下拉列表中获得。</li>
  <li><strong>容器名称</strong>: Rancher会检查一个主机是否有一个具有特定名称的容器。 如果稍后时间，容器有名称更改或不活动/已删除，该规则将不再有效。 运行容器的列表可从值字段的下拉列表中获得。</li>
</ul>

<h3 id="rancher-compose">在Rancher Compose中添加标签</h3>

<p>Rancher根据<code class="highlighter-rouge">docker-compose.yml</code>文件中定义的<code class="highlighter-rouge">labels</code>来决定如何安排一个服务的容器。 所有带有调度的标签都将在<code class="highlighter-rouge">docker-compose.yml</code>文件中使用。 Rancher通过3个主要组件定义了调度规则：条件，字段和值。 条件决定了Rancher遵守规则的严格程度。 字段是要比较的项目。 价值是你在字段上定义的。 在介绍一些例子之前，我们将广泛讨论这些组件。</p>

<h4 id="section-6">调度条件</h4>

<p>当我们编写我们的调度规则时，我们对每个规则都有条件，这说明了Rancher如何使用规则。亲和条件是当我们试图找到一个符合我们的价值的字段。反亲和条件是当我们试图找到一个不符合我们价值的字段时。</p>

<p>为了区分亲和力和反亲和度，我们在标签名称中添加<code class="highlighter-rouge">_ne</code>来表示标签是<strong>不</strong>符合字段和值。</p>

<p>规则也有硬条件和软条件。</p>

<p>一个硬条件相当于说<strong>必须</strong>或<strong>不能</strong>。 Rancher只会使用匹配或不匹配字段和值的主机。如果Rancher找不到符合这些条件的所有规则的主机，你的服务可能会停留在 <em>Activating</em> 状态。该服务将不断尝试找到容器的主机。要修复此状态，你可以编辑服务的数量或添加/编辑一台主机来满足所有这些规则。</p>

<p>一个软条件相当于<strong>应该</strong>或<strong>不应该</strong>。 Rancher将尝试使用与该字段和值相匹配的主机。在没有匹配所有规则的主机的情况下，Rancher将逐个删除软约束（应该/不应该规则），直到主机满足剩余的约束。</p>

<p>为了区分 <em>must</em> 和 <em>should</em> 条件，我们将“_soft”添加到我们的标签名称中，以表明标签是<strong>应该</strong>尝试匹配字段和值。</p>

<h4 id="section-7">字段</h4>

<p>Rancher能够与主机标签，容器标签，容器名称或服务名称的值进行比较。 标签前缀是Rancher用来定义哪个字段将被评估的用法。</p>

<table>
  <thead>
    <tr>
      <th>字段</th>
      <th>标签前缀</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>主机标签</td>
      <td><code class="highlighter-rouge">io.rancher.scheduler.affinity:host_label</code></td>
    </tr>
    <tr>
      <td>容器标签/服务名称</td>
      <td><code class="highlighter-rouge">io.rancher.scheduler.affinity:container_label</code></td>
    </tr>
    <tr>
      <td>容器名称</td>
      <td><code class="highlighter-rouge">io.rancher.scheduler.affinity:container</code></td>
    </tr>
  </tbody>
</table>

<p>请注意，服务名称中没有特定的前缀。 当Rancher创建服务时，会将系统标签添加到服务的所有容器中，以指示应用和服务名称。</p>

<p>当我们创建标签的关键字时，我们从一个字段前缀（例如<code class="highlighter-rouge">io.rancher.scheduler.affinity：host_label</code>）开始，根据我们正在寻找的条件，我们附加我们想要的条件类型。 例如，如果我们希望容器在不能等于（即<code class="highlighter-rouge">_ne</code>）主机标签值的主机上启动，则标签键将是<code class="highlighter-rouge">io.rancher.scheduler.affinity：host_label_ne</code>。</p>

<h4 id="section-8">值</h4>

<p>你可以使用这些值来定义要检查的字段。 如果你有两个值要与同一条件和字段进行比较，则需要为标签名称使用一个标签。 对于标签的值，你需要使用逗号分隔列表。 如果有多个具有相同键的标签（例如<code class="highlighter-rouge">io.rancher.scheduler.affinity：host_label_ne</code>），则Rancher将使用与标签键一起使用的最后一个值覆盖任何先前的值。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="s">io.rancher.scheduler.affinity:host_label</span><span class="pi">:</span> <span class="s">key1=value1,key2=value2</span>
</code></pre>
</div>

<h4 id="section-9">全局服务</h4>

<p>将服务提供到全局服务中相当于在UI中的每个主机上选择<strong>总是在每台主机上运行一个此容器的实例</strong>。 这意味着将在<a href="/docs/rancher/v1.6/zh/environments/">环境</a>中的任何主机上启动一个容器。 如果将新主机添加到环境中，并且主机满足全局服务的主机要求，则该服务将自动启动。</p>

<p>目前，全局服务只支持使用硬条件的主机标签字段。 这意味着只有在调度时才会遵守与<code class="highlighter-rouge">主机标签</code>相关的标签，并且<strong>必须</strong>或<strong>不能</strong>等于该值。 任何其他标签类型将被忽略。</p>

<h5 id="docker-composeyml">例子 <code class="highlighter-rouge">docker-compose.yml</code></h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
<span class="s">services</span><span class="pi">:</span>
  <span class="s">wordpress</span><span class="pi">:</span>
    <span class="s">labels</span><span class="pi">:</span>
      <span class="c1"># 使wordpress成为全局服务</span>
      <span class="s">io.rancher.scheduler.global</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
      <span class="c1"># 使wordpress只在具有key1 = value1标签的主机上运行容器</span>
      <span class="s">io.rancher.scheduler.affinity:host_label</span><span class="pi">:</span> <span class="s">key1=value1</span>
      <span class="c1"># 使wordpress只在没有key2 = value2标签的主机上运行</span>
      <span class="s">io.rancher.scheduler.affinity:host_label_ne</span><span class="pi">:</span> <span class="s">key2=value2</span>
    <span class="s">image</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="s">links</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">db</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="s">stdin_open</span><span class="pi">:</span> <span class="s">true</span>
</code></pre>
</div>

<h4 id="section-10">使用主机标签查找主机</h4>

<p>将主机添加到Rancher时，你可以添加<a href="/docs/rancher/v1.6/zh/hosts/#主机标签">主机标签</a>。 调度服务时，你可以利用这些标签来创建规则来选择要部署服务的主机。</p>

<h5 id="section-11">使用主机标签的示例</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="c1"># 主机必须有`key1 = value1`的标签</span>
  <span class="s">io.rancher.scheduler.affinity:host_label</span><span class="pi">:</span> <span class="s">key1=value1</span>
  <span class="c1"># 主机不得有`key2 = value2`的标签</span>
  <span class="s">io.rancher.scheduler.affinity:host_label_ne</span><span class="pi">:</span> <span class="s">key2=value2</span>
  <span class="c1"># 主机应该有`key3 = value3`的标签</span>
  <span class="s">io.rancher.scheduler.affinity:host_label_soft</span><span class="pi">:</span> <span class="s">key3=value3</span>
  <span class="c1"># 主机应该没有`key4 = value4`的标签</span>
  <span class="s">io.rancher.scheduler.affinity:host_label_soft_ne</span><span class="pi">:</span> <span class="s">key4=value4</span>
</code></pre>
</div>

<h5 id="section-12">自动创建的主机标签</h5>

<p>Rancher会自动创建与主机的linux内核版本和Docker Engine版本相关的主机标签。</p>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Value</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">io.rancher.host.linux_kernel_version</code></td>
      <td>主机上的Linux内核版本 (例如3.19)</td>
      <td>主机上运行的Linux内核的版本</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">io.rancher.host.docker_version</code></td>
      <td>主机上的Docker版本（例如<code class="highlighter-rouge">1.10.3</code>）</td>
      <td>主机上运行的Docker Engine版本</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">io.rancher.host.provider</code></td>
      <td>云提供商信息</td>
      <td>云提供商名称（目前仅适用于AWS）</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">io.rancher.host.region</code></td>
      <td>云提供商区域</td>
      <td>云提供商区域（目前仅适用于AWS）</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">io.rancher.host.zone</code></td>
      <td>云提供商可用区</td>
      <td>云提供商可用区（目前仅适用于AWS）</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
<span class="c1"># 主机必须运行Docker版本1.10.3</span>
<span class="s">io.rancher.scheduler.affinity:host_label</span><span class="pi">:</span> <span class="s">io.rancher.host.docker_version=1.10.3</span>
<span class="c1"># 主机必须不运行Docker 1.6版</span>
<span class="s">io.rancher.scheduler.affinity:host_label_ne</span><span class="pi">:</span> <span class="s">io.rancher.host.docker_version=1.6</span>
</code></pre>
</div>

<p><br /></p>

<blockquote>
  <p><strong>注意：</strong> Rancher不支持在具有<code class="highlighter-rouge">&gt;=</code>特定版本的主机上调度容器的概念。 你可以使用主机调度规则来创建特定的白名单和黑名单，以确定你的服务是否需要特定版本的Docker Engine。</p>
</blockquote>

<h4 id="section-13">用容器标签查找主机</h4>

<p>向Rancher添加容器或服务时，可以添加容器标签。 这些标签可以用于你希望规则与之进行比较的字段。 提醒：如果将全局服务设置为true，则无法使用。</p>

<blockquote>
  <p><strong>注意：</strong>如果容器标签有多个值，Rancher会查看主机上所有容器上的所有标签，以检查容器标签。 多个值不需要在主机上的同一容器上。</p>
</blockquote>

<h5 id="section-14">使用容器标签的示例</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="c1"># 主机必须有一个标签为`key1=value1`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_label</span><span class="pi">:</span> <span class="s">key1=value1</span>
  <span class="c1"># 主机不能有一个标签为`key2=value2`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_label_ne</span><span class="pi">:</span> <span class="s">key2=value2</span>
  <span class="s">＃主机应该有一个标签为`key3=value3`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_label_soft</span><span class="pi">:</span> <span class="s">key3=value3</span>
  <span class="c1"># 主机应该没有一个标签为`key4=value4`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_label_soft_ne</span><span class="pi">:</span> <span class="s">key4=value4</span>
</code></pre>
</div>

<h5 id="section-15">服务名称</h5>

<p>当Rancher Compose启动服务的容器时，它也会自动创建多个容器标签。 因为检查一个特定的容器标签正在寻找一个<code class="highlighter-rouge">key=value</code>，所以我们可以使用这些系统标签作为我们规则的关键。 以下是在Rancher启动服务时在容器上创建的系统标签：</p>

<table>
  <thead>
    <tr>
      <th>标签</th>
      <th>值</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>io.rancher.stack.name</td>
      <td><code class="highlighter-rouge">$${stack_name}</code></td>
    </tr>
    <tr>
      <td>io.rancher.stack_service.name</td>
      <td><code class="highlighter-rouge">$${stack_name}/$${service_name}</code></td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<blockquote>
  <p><strong>注意：</strong> 使用<code class="highlighter-rouge">io.rancher.stack_service.name</code>时，该值必须为<code class="highlighter-rouge">应用名称/服务名称</code>的格式。</p>
</blockquote>

<p>宏<code class="highlighter-rouge">$$ {stack_name}</code>和<code class="highlighter-rouge">$$ {service_name}</code>也可以在任何其他<code class="highlighter-rouge">标签</code>中的<code class="highlighter-rouge">docker-compose.yml</code>文件中使用，并在服务启动时进行评估。</p>

<h5 id="section-16">使用服务名称的示例</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="c1"># Host必须有一个服务名称为`value1`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_label</span><span class="pi">:</span> <span class="s">io.rancher.stack_service.name=stackname/servicename</span>
</code></pre>
</div>

<h4 id="section-17">查找具有容器名称的主机</h4>

<p>向Rancher添加容器时，可以给每个容器一个名称。 你可以使用此名称作为希望规则进行比较的字段。 提醒：如果将全局服务设置为true，则无法使用。</p>

<h5 id="section-18">使用容器名称的示例</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="c1"># 主机必须有一个名为`value1`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container</span><span class="pi">:</span> <span class="s">value1</span>
  <span class="c1"># 主机不能有一个名称为`value2`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_ne</span><span class="pi">:</span> <span class="s">value2</span>
  <span class="c1"># 主机应该有一个名称为`value3`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_soft</span><span class="pi">:</span> <span class="s">value3</span>
  <span class="c1"># 主机应该没有一个名为`value4`的容器</span>
  <span class="s">io.rancher.scheduler.affinity:container_soft_ne</span><span class="pi">:</span> <span class="s">value4</span>
</code></pre>
</div>

<h3 id="section-19">示例</h3>

<h4 id="section-20">示例1:</h4>

<p>典型的调度策略可能是尝试在不同的可用主机之间部署服务的容器。 实现这一点的一个方法是使用反相关性规则来关联自身:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="s">io.rancher.scheduler.affinity:container_label_ne</span><span class="pi">:</span> <span class="s">io.rancher.stack_service.name=$${stack_name}/$${service_name}</span>
</code></pre>
</div>

<p>由于这是一个很强的反相关性规则，如果比例大于可用主机数量，我们可能会遇到问题。 在这种情况下，我们可能需要使用软反相关性规则，以便调度程序仍然允许将容器部署到已经具有该容器的主机。 基本上，这是一个软规则，所以如果没有更好的选择存在，它可以被忽略。<br />
<code class="highlighter-rouge">yaml
labels:
  io.rancher.scheduler.affinity:container_label_soft_ne: io.rancher.stack_service.name=$${stack_name}/$${service_name}
</code></p>

<h4 id="section-21">示例2:</h4>

<p>另一个例子可能是将所有容器部署在同一个主机上，而不考虑哪个主机。 在这种情况下，可以使用对其自身的软亲合力。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">labels</span><span class="pi">:</span>
  <span class="s">io.rancher.scheduler.affinity:container_label_soft</span><span class="pi">:</span> <span class="s">io.rancher.stack_service.name=$${stack_name}/$${service_name}</span>
</code></pre>
</div>

<p>如果选择了自己的硬约束规则，则第一个容器的部署将失败，因为目前没有运行该服务的主机。</p>

<h3 id="section-22">调度标签表</h3>

<table>
  <thead>
    <tr>
      <th>标签</th>
      <th>值</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>io.rancher.scheduler.global</td>
      <td>true</td>
      <td>将此服务指定为全局服务</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:host_label</td>
      <td>key1=value1,key2=value2, etc…</td>
      <td>容器<strong>必须</strong>部署到具有标签<code class="highlighter-rouge">key1=value1</code>和<code class="highlighter-rouge">key2 = value2</code>的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:host_label_soft</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>应该</strong>被部署到具有标签<code class="highlighter-rouge">key1=value1</code>和<code class="highlighter-rouge">key2=value2”</code>的主机</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:host_label_ne</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>不能</strong>被部署到具有标签<code class="highlighter-rouge">key1=value1</code>或<code class="highlighter-rouge">key2=value2</code>的主机</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:host_label_soft_ne</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>不应该</strong>被部署到具有标签<code class="highlighter-rouge">key1=value1</code>或<code class="highlighter-rouge">key2=value2</code>的主机</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_label</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>必须</strong>部署到具有标签<code class="highlighter-rouge">key1=value1</code>和<code class="highlighter-rouge">key2=value2</code>的容器的主机上。 注意：这些标签不必在同一个容器上。 可以在同一主机内的不同容器上。</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_label_soft</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>应该</strong>部署到具有运行标签<code class="highlighter-rouge">key1=value1</code>和<code class="highlighter-rouge">key2=value2</code>的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_label_ne</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>不能</strong>部署到具有运行标签<code class="highlighter-rouge">key1=value1</code>或<code class="highlighter-rouge">key2=value2</code>的容器的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_label_soft_ne</td>
      <td>key1=value1,key2=value2</td>
      <td>容器<strong>不应该</strong>被部署到具有标签<code class="highlighter-rouge">key1=value1</code>或<code class="highlighter-rouge">key2=value2</code>的容器的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container</td>
      <td>container_name1,container_name2</td>
      <td>容器<strong>必须</strong>部署到具有名称为<code class="highlighter-rouge">container_name1</code>和<code class="highlighter-rouge">container_name2</code>运行的容器的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_soft</td>
      <td>container_name1,container_name2</td>
      <td>容器<strong>应该</strong>被部署到具有名称为<code class="highlighter-rouge">container_name1</code>和<code class="highlighter-rouge">container_name2</code>运行的容器的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_ne</td>
      <td>container_name1,container_name2</td>
      <td>容器<strong>不能</strong>部署到具有名称为<code class="highlighter-rouge">container_name1</code>或<code class="highlighter-rouge">container_name2</code>运行的容器的主机上</td>
    </tr>
    <tr>
      <td>io.rancher.scheduler.affinity:container_soft_ne</td>
      <td>container_name1,container_name2</td>
      <td>容器<strong>不应该</strong>被部署到具有容器名称为<code class="highlighter-rouge">container_name1</code>或<code class="highlighter-rouge">container_name2</code>运行的主机</td>
    </tr>
  </tbody>
</table>

    </div>
</div>
</div>
</div>

<div class="row wrap">
<a class="btn btn-primary pull-right" href="https://github.com/rancher/rancher.github.io/tree/master/rancher/v1.6/zh/cattle/scheduling/index.md">Edit this page <i class="fa fa-pencil"></i></a>
</div>

<footer class="clearfix">
  <div class="wrap">
    <div class=""><!--bottom footer-->
      <div class="row">
          <div class="col span-6">
              <ul id="menu-footer" class="list-inline">
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="About Rancher Labs" href="http://rancher.com/about/">About Rancher Labs</a></li>
                  <li id="menu-item-11352" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11352"><a title="Contact" href="http://rancher.com/contact/">Contact</a></li>
                  <li id="menu-item-14152" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14152"><a title="Privacy" href="http://rancher.com/privacy/">Privacy</a></li>
                  <li id="menu-item-15635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-15635"><a title="Careers" href="http://rancher.com/careers/">Careers</a></li>
                  
                  <li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="English Docs" href="https://rancher.com/docs/rancher/latest/en/">English Docs</a></li>
                  
              </ul>
              <p>Copyright &copy; 2014-2017 <a href="http://rancher.com">Rancher Labs</a>. All Rights Reserved.</p>
          </div>
          <div class="col span-6 text-right">
              <ul class="list-inline">
                  <li><a href="https://github.com/rancher/rancher" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-github.png" alt="Rancher Labs GitHub"></a></li>
                  <li><a href="https://twitter.com/Rancher_Labs" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-twitter.png" alt="Rancher Labs Twitter"></a></li>
                  <li><a href="https://slack.rancher.io/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-slack.png" alt="Rancher Labs Slack"></a></li>
                  <li><a href="https://www.linkedin.com/groups/6977008/profile" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-linkedin.png" alt="Rancher Labs LinkedIn"></a></li>
                  <li><a href="https://www.facebook.com/rancherlabs/" target="_blank"><img src="http://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-fb.png" alt="Rancher Labs Facebook"></a></li>
              </ul>
          </div>
      </div>
    </div><!--bottom footer-->
    </div>
</footer>
<script src="/docs/vendor/jquery.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/jquery.slicknav.min.js?t=2017-12-04 13:23:19 -0800"></script>
<script src="/docs/js/rancher-docs.js?t=2017-12-04 13:23:19 -0800"></script>
<!-- Start of Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-56382716-3', 'auto');
ga('send', 'pageview');
</script>
<!-- End of Google Analytics -->
<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d, s, i, r) {
    if (d.getElementById(i)) { return; }
    var n = d.createElement(s),
        e = d.getElementsByTagName(s)[0];
    n.id = i;
    n.src = '//js.hs-analytics.net/analytics/' + (Math.ceil(new Date() / r) * r) + '/468859.js';
    e.parentNode.insertBefore(n, e);
})(document, "script", "hs-analytics", 300000);
</script>
<!-- End of Async HubSpot Analytics Code -->
</body>

</html>

